<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://guoxiaxing.github.io/Blog/typescript</id>
    <title>Try's Blog Blog</title>
    <updated>2021-12-06T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://guoxiaxing.github.io/Blog/typescript"/>
    <subtitle>Try's Blog Blog</subtitle>
    <icon>https://guoxiaxing.github.io/Blog/img/logo.jpeg</icon>
    <entry>
        <title type="html"><![CDATA[Typescript 4.0 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-4.0</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-4.0"/>
        <updated>2021-12-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[å†™åœ¨å‰é¢]]></summary>
        <content type="html"><![CDATA[<h2>å†™åœ¨å‰é¢</h2><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ–°æ–°ç‰¹æ€§ï¼Œåªæ˜¯ç½—åˆ—ä¸€äº›é‡ç‚¹çš„</p><h2>å¯å˜å…ƒç¥–ç±»å‹</h2><h3>å…ƒç»„ç±»å‹è¯­æ³•ä¸­çš„ spread ç°åœ¨å¯ä»¥æ³›å‹</h3><pre><code class="language-typescript">function tail&lt;T extends any[]&gt;(arr: readonly [any, ...T]) {
  const [_ignored, ...rest] = arr;
  return rest;
}
const myTuple = [1, 2, 3, 4] as const;
const myArray = [&quot;hello&quot;, &quot;world&quot;];
// type [2, 3, 4]
const r1 = tail(myTuple);
// type [2, 3, ...string[]]
const r2 = tail([...myTuple, ...myArray] as const);
</code></pre><h3>rest å…ƒç´ å¯ä»¥å‡ºç°åœ¨å…ƒç»„ä¸­çš„ä»»ä½•ä½ç½®ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨ç»“å°¾</h3><pre><code class="language-typescript">type Strings = [string, string];
type Numbers = [number, number];
// [string, string, number, number]
type StrStrNumNum = [...Strings, ...Numbers];
</code></pre><p>å½“æˆ‘ä»¬åœ¨æ²¡æœ‰å·²çŸ¥é•¿åº¦çš„ç±»å‹ä¸­ spread æ—¶ï¼Œç»“æœç±»å‹ä¹Ÿå°†å˜å¾—ä¸å—é™åˆ¶ï¼Œå¹¶ä¸”åé¢çš„æ‰€æœ‰å…ƒç´ éƒ½ä¼šå˜ä¸ºç»“æœçš„ rest å…ƒç´ ç±»å‹ã€‚</p><pre><code class="language-typescript">type Strings = [string, string];
type Numbers = number[];
// [string, string, ...Array&lt;number | boolean&gt;]
type Unbounded = [...Strings, ...Numbers, boolean];
</code></pre><h2>æ ‡è®°çš„å…ƒç»„å…ƒç´ </h2><pre><code class="language-typescript">type Range = [start: number, end: number];
</code></pre><p><strong>æ ‡è®°å…ƒç»„ä½¿ç”¨æ—¶æœ‰äº›è§„åˆ™ï¼Œå…¶ä¸­ä¸€æ¡æ˜¯ï¼šåœ¨æ ‡è®°ä¸€ä¸ªå…ƒç»„å…ƒç´ æ—¶ï¼Œè¿˜å¿…é¡»æ ‡è®°å…ƒç»„ä¸­çš„æ‰€æœ‰å…¶ä»–å…ƒç´ ã€‚</strong></p><h2>æ„é€ å™¨çš„ç±»å±æ€§æ¨æ–­</h2><pre><code class="language-typescript">class Square {
  // Previously: implicit any!
  // Now: inferred to `number`!
  area;
  sideLength;
  constructor(sideLength: number) {
    this.sideLength = sideLength;
    this.area = sideLength ** 2;
  }
}
</code></pre><p>å¦‚æœæ„é€ å™¨çš„è·¯å¾„å¹¶ééƒ½åˆ†é…ç»™ä¸€ä¸ªå®ä¾‹æˆå‘˜ï¼Œåˆ™è¯¥å±æ€§å¯èƒ½è¢«è®¤ä¸ºæ˜¯ undefined çš„ã€‚</p><pre><code class="language-javascript">class Square {
  sideLength;
  constructor(sideLength: number) {
    if (Math.random()) {
      this.sideLength = sideLength;
    }
  }
  get area() {
    return this.sideLength ** 2;
    //     ~~~~~~~~~~~~~~~
    // error! Object is possibly &#x27;undefined&#x27;.
  }
}
</code></pre><p>å½“ä½ å¤„äº strictPropertyInitialization ä¸­æ—¶ï¼Œéœ€è¦ä½¿ç”¨æ˜¾å¼ç±»å‹æ³¨é‡Šä»¥åŠæ˜ç¡®çš„èµ‹å€¼æ–­è¨€ï¼ˆ!ï¼‰ã€‚</p><pre><code class="language-typescript">class Square {
  // definite assignment assertion
  //        v
  sideLength!: number;
  //         ^^^^^^^^
  // type annotation
  constructor(sideLength: number) {
    this.initialize(sideLength);
  }
  initialize(sideLength: number) {
    this.sideLength = sideLength;
  }
  get area() {
    return this.sideLength ** 2;
  }
}
</code></pre><h2>çŸ­è·¯èµ‹å€¼è¿ç®—ç¬¦</h2><p>JavaScript ä¸­æœ‰å¾ˆå¤šè¿ç®—ç¬¦éƒ½æœ‰å¯¹åº”çš„èµ‹å€¼è¿ç®—ç¬¦ï¼ä½†æ˜¯æœ‰ä¸‰ä¸ªå€¼å¾—æ³¨æ„çš„ä¾‹å¤–ï¼šé€»è¾‘å’Œï¼ˆ&amp;&amp;ï¼‰ï¼Œé€»è¾‘æˆ–ï¼ˆ||ï¼‰å’Œç©ºå€¼åˆå¹¶ï¼ˆ??ï¼‰ã€‚</p><p>æ‰€ä»¥ TypeScript 4.0 æ”¯æŒäº†ä¸€ä¸ªæ–°çš„ ECMAScript ç‰¹æ€§ï¼Œæ·»åŠ äº†ä¸‰ä¸ªæ–°çš„èµ‹å€¼è¿ç®—ç¬¦ï¼š&amp;&amp;=ï¼Œ||=å’Œ??=ã€‚</p><p>è¿™äº›è¿ç®—ç¬¦éå¸¸é€‚åˆæ›¿æ¢ä¸‹é¢è¿™ç§ä»£ç ç¤ºä¾‹ï¼š</p><pre><code class="language-typescript">a = a &amp;&amp; b;
a = a || b;
a = a ?? b;
</code></pre><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯è¿™äº›è¿ç®—ç¬¦ä»…åœ¨å¿…è¦æ—¶æ‰§è¡Œèµ‹å€¼ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œ&quot;çŸ­è·¯&quot;çš„ä¸ä»…æ˜¯è¿ç®—ç¬¦çš„å³ä¾§ï¼Œèµ‹å€¼æœ¬èº«ä¹ŸçŸ­è·¯äº†</strong>
<strong>ä¹Ÿå°±æ˜¯è¯´å½“å·¦ä¾§çš„å€¼æ˜¯å‡å€¼ï¼Œèµ‹å€¼ä¸€å®šä¼šæ‰§è¡Œï¼Œå·¦ä¾§æ˜¯çœŸçš„å€¼æ˜¯ï¼Œå¹¶ä¸ä¼šèµ‹å€¼</strong></p><pre><code class="language-typescript">obj.prop ||= foo();
// roughly equivalent to either of the following
obj.prop || (obj.prop = foo());
if (!obj.prop) {
    obj.prop = foo();
}
</code></pre><h2>catch å­å¥ç»‘å®šæ”¯æŒ unknown</h2><p>è‡ª TypeScript è¯ç”Ÿä»¥æ¥ï¼Œcatch å­å¥å˜é‡å§‹ç»ˆæŒ‰ any ç±»å‹åŒ–ã€‚è¿™æ„å‘³ç€ TypeScript å…è®¸ä½ å¯¹å®ƒä»¬è¿›è¡Œä»»ä½•æ“ä½œã€‚
å› æ­¤ï¼ŒTypeScript 4.0 ç°åœ¨å…è®¸ä½ å°† catch å­å¥å˜é‡çš„ç±»å‹æŒ‡å®šä¸º unknownã€‚unknown æ¯” any æ›´å®‰å…¨ï¼Œå› ä¸ºå®ƒä¼šåœ¨æˆ‘ä»¬æ“ä½œå€¼ä¹‹å‰æé†’æˆ‘ä»¬æ‰§è¡ŒæŸç§ç±»å‹æ£€æŸ¥ã€‚</p><h2>å±æ€§é‡å†™è®¿é—®å™¨ï¼ˆåä¹‹äº¦ç„¶ï¼‰æ˜¯é”™è¯¯</h2><p>ä»¥å‰ï¼Œåªæœ‰åœ¨ä½¿ç”¨ useDefineForClassFields æ—¶ï¼Œå±æ€§é‡å†™è®¿é—®å™¨æˆ–è®¿é—®å™¨é‡å†™å±æ€§æ˜¯ä¸€ä¸ªé”™è¯¯ï¼›ä½†ç°åœ¨ï¼Œåœ¨æ´¾ç”Ÿç±»ä¸­å£°æ˜ä¸€ä¸ªå°†é‡å†™åŸºç±»ä¸­çš„ getter æˆ– setter çš„å±æ€§æ—¶æ€»æ˜¯å‘å‡ºé”™è¯¯ã€‚</p><pre><code class="language-typescript">class Base {
  get foo() {
    return 100;
  }
  set foo() {
    // ...
  }
}
class Derived extends Base {
  foo = 10;
  //  ~~~
  // error!
  // &#x27;foo&#x27; is defined as an accessor in class &#x27;Base&#x27;,
  // but is overridden here in &#x27;Derived&#x27; as an instance property.
}
</code></pre><pre><code class="language-typescript">class Base {
  prop = 10;
}
class Derived extends Base {
  get prop() {
    //  ~~~~
    // error!
    // &#x27;prop&#x27; is defined as a property in class &#x27;Base&#x27;, but is overridden here in &#x27;Derived&#x27; as an accessor.
    return 100;
  }
}
</code></pre><h2>delete çš„æ“ä½œæ•°å¿…é¡»æ˜¯å¯é€‰çš„</h2><p>åœ¨ strictNullChecks ä¸­ä½¿ç”¨ delete è¿ç®—ç¬¦æ—¶ï¼Œæ“ä½œæ•°ç°åœ¨å¿…é¡»ä¸º anyã€unknownã€never æˆ–ä¸ºå¯é€‰ï¼ˆå› ä¸ºå®ƒåœ¨ç±»å‹ä¸­åŒ…å« undefinedï¼‰ã€‚å¦åˆ™ï¼Œä½¿ç”¨ delete è¿ç®—ç¬¦æ˜¯é”™è¯¯çš„ã€‚</p><pre><code class="language-typescript">interface Thing {
  prop: string;
}
function f(x: Thing) {
  delete x.prop;
  //     ~~~~~~
  // error! The operand of a &#x27;delete&#x27; operator must be optional.
}
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 4.1 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-4.1</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-4.1"/>
        <updated>2021-12-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[æ¨¡ç‰ˆå­—é¢é‡ç±»å‹]]></summary>
        <content type="html"><![CDATA[<h2>æ¨¡ç‰ˆå­—é¢é‡ç±»å‹</h2><pre><code class="language-typescript">type World = &quot;world&quot;;
type Greeting = `hello ${World}`;
// same as
//   type Greeting = &quot;hello world&quot;;
</code></pre><p>åœ¨æ›¿ä»£ä½ç½®æœ‰è”åˆç±»å‹å‘¢ï¼Ÿå®ƒä¼šç”Ÿæˆå¯ä»¥ç”±æ¯ä¸ªè”åˆæˆå‘˜è¡¨ç¤ºçš„æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦ä¸²å­—é¢é‡çš„é›†åˆã€‚</p><pre><code class="language-typescript">type Color = &quot;red&quot; | &quot;blue&quot;;
type Quantity = &quot;one&quot; | &quot;two&quot;;
type SeussFish = `${Quantity | Color} fish`;
// same as
//   type SeussFish = &quot;one fish&quot; | &quot;two fish&quot;
//                  | &quot;red fish&quot; | &quot;blue fish&quot;;5
</code></pre><h2>æ˜ å°„ç±»å‹ä¸­åŠ å…¥é”®é‡æ˜ å°„</h2><p>TypeScript 4.1 å…è®¸ä½ ä½¿ç”¨æ–°çš„ as å­å¥é‡æ–°æ˜ å°„æ˜ å°„ç±»å‹ä¸­çš„é”®ã€‚</p><pre><code class="language-typescript">type MappedTypeWithNewKeys&lt;T&gt; = {
    [K in keyof T as NewKeyType]: T[K]
    //            ^^^^^^^^^^^^^
    //            This is the new syntax!
}
</code></pre><p>æœ‰äº†è¿™ä¸ªæ–°çš„ as å­å¥ï¼Œä½ å¯ä»¥åˆ©ç”¨æ¨¡æ¿å­—é¢é‡ç±»å‹ä¹‹ç±»çš„ç‰¹æ€§ï¼Œè½»æ¾åœ°åŸºäºæ—§åç§°åˆ›å»ºå±æ€§åç§°ã€‚</p><pre><code class="language-typescript">type Getters&lt;T&gt; = {
    [K in keyof T as `get${Capitalize&lt;string &amp; K&gt;}`]: () =&gt; T[K]
};
interface Person {
    name: string;
    age: number;
    location: string;
}
type LazyPerson = Getters&lt;Person&gt;
// type LazyPerson = {
//     getName: () =&gt; string;
//     getAge: () =&gt; number;
//     getLocation: () =&gt; string;
// }
</code></pre><pre><code class="language-typescript">// Remove the &#x27;kind&#x27; property
type RemoveKindField&lt;T&gt; = {
    [K in keyof T as Exclude&lt;K, &quot;kind&quot;&gt;]: T[K]
};


interface Circle {
    kind: &quot;circle&quot;;
    radius: number;
}


type KindlessCircle = RemoveKindField&lt;Circle&gt;;
// same as
//   type KindlessCircle = {
//       radius: number;
//   }
</code></pre><h2>é€’å½’æ¡ä»¶ç±»å‹</h2><p>åœ¨ TypeScript 4.1 ä¸­ï¼Œæ¡ä»¶ç±»å‹ç°åœ¨å¯ä»¥ç«‹å³åœ¨å…¶åˆ†æ”¯ä¸­å¼•ç”¨è‡ªèº«ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ›´å®¹æ˜“ç¼–å†™é€’å½’ç±»å‹åˆ«åäº†
å¦‚æœæˆ‘ä»¬æƒ³ç¼–å†™ä¸€ä¸ªç±»å‹æ¥è·å–åµŒå¥—æ•°ç»„çš„å…ƒç´ ç±»å‹ï¼Œåˆ™å¯ä»¥ç¼–å†™ä»¥ä¸‹ deepFlatten ç±»å‹ã€‚</p><pre><code class="language-typescript">type ElementType&lt;T&gt; = T extends ReadonlyArray&lt;infer U&gt; ? ElementType&lt;U&gt; : T;

function deepFlatten&lt;T extends readonly unknown[]&gt;(x: T): ElementType&lt;T&gt;[] {
  throw &quot;not implemented&quot;;
}

// All of these return the type &#x27;number[]&#x27;:
deepFlatten([1, 2, 3]);
deepFlatten([[1], [2, 3]]);
deepFlatten([[1], [[2]], [[[3]]]]);
</code></pre><h2>any/unknown åœ¨ falsy ä½ç½®ä¼ æ’­</h2><p>ä»¥å‰ï¼Œå¯¹äºåƒ foo &amp;&amp; somethingElse è¿™æ ·çš„è¡¨è¾¾å¼ï¼Œfoo çš„ç±»å‹æ˜¯ any æˆ– unknown çš„ï¼Œæ•´ä¸ªè¡¨è¾¾å¼çš„ç±»å‹å°†æ˜¯ somethingElse çš„ç±»å‹ã€‚</p><pre><code class="language-typescript">declare let foo: unknown;
declare let somethingElse: { someProp: string };
let x = foo &amp;&amp; somethingElse; // { someProp: string }
</code></pre><p>ä½†åœ¨ TypeScript 4.1 ä¸­ï¼Œæˆ‘ä»¬ä¼šæ›´è°¨æ…åœ°ç¡®å®šè¿™ç§ç±»å‹ã€‚ç”±äºå¯¹ &amp;&amp; å·¦ä¾§çš„ç±»å‹ä¸€æ— æ‰€çŸ¥ï¼Œå› æ­¤æˆ‘ä»¬å°†å‘å¤–ä¼ æ’­ any å’Œ unknownï¼Œè€Œä¸æ˜¯å°†å³ä¾§çš„ç±»å‹ä¼ æ’­å‡ºå»ã€‚</p><pre><code class="language-typescript">declare let foo: unknown;
declare let somethingElse: { someProp: string };
let x = foo &amp;&amp; somethingElse; // unknown
</code></pre><h2>æ¡ä»¶ spread åˆ›å»ºå¯é€‰å±æ€§</h2><p>åœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡ spreadï¼ˆä¾‹å¦‚{ ...foo }ï¼‰ä¸ä¼šå¯¹è™šå‡å€¼èµ·ä½œç”¨ã€‚å› æ­¤ï¼Œåœ¨ç±»ä¼¼{ ...foo }çš„ä»£ç ä¸­ï¼Œå¦‚æœ foo ä¸º null æˆ– undefinedï¼Œåˆ™ä¼šè·³è¿‡ fooã€‚</p><pre><code class="language-typescript">interface Person {
    name: string;
    age: number;
    location: string;
}
interface Animal {
    name: string;
    owner: Person;
}
function copyOwner(pet?: Animal) {
    return {
        ...(pet &amp;&amp; pet.owner),
        otherStuff: 123
    }
}
// We could also use optional chaining here:
function copyOwner(pet?: Animal) {
    return {
        ...(pet?.owner),
        otherStuff: 123
</code></pre><p>åœ¨è¿™é‡Œï¼Œå¦‚æœå®šä¹‰äº† petï¼Œåˆ™ pet.owner çš„å±æ€§å°†è¢« spread è¿›å»ï¼›å¦åˆ™ï¼Œä¸ä¼šå°†ä»»ä½•å±æ€§ spread åˆ°è¿”å›çš„å¯¹è±¡ä¸­ã€‚
copyOwner çš„è¿”å›ç±»å‹ä»¥å‰æ˜¯åŸºäºæ¯ä¸ª spread çš„è”åˆç±»å‹ï¼š</p><pre><code class="language-typescript">{ otherStuff: number } | { otherStuff: number, name: string, age: number, location: string }
</code></pre><p>åœ¨ TypeScript 4.1 ä¸­ï¼Œè¿”å›çš„ç±»å‹æ”¹ä¸ºä½¿ç”¨ all-optional å±æ€§ã€‚</p><pre><code class="language-typescript">{
    otherStuff: number;
    name?: string;
    age?: number;
    location?: string;
}
</code></pre><h2>åœ¨ Promise ä¸­ï¼Œresolve çš„å‚æ•°ä¸å†å¯é€‰</h2><p>ä½†æœ‰æ—¶ç¡®å®éœ€è¦åœ¨æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨ resolve()ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ Promise ä¸€ä¸ªæ˜¾å¼çš„ void æ³›å‹ç±»å‹å‚æ•°ï¼ˆå³å°†å…¶å†™ä¸º <code>Promise&lt;void&gt;</code>ï¼‰ã€‚è¿™åˆ©ç”¨äº† TypeScript 4.1 ä¸­çš„æ–°åŠŸèƒ½ï¼Œå…¶ä¸­å¯èƒ½æ˜¯ void çš„å°¾éšå‚æ•°å¯ä»¥å˜ä¸ºå¯é€‰ã€‚</p><pre><code class="language-typescript">new Promise&lt;void&gt;(resolve =&gt; {
  //     ^^^^^^
  doSomethingAsync(() =&gt; {
    doSomething();
    resolve();
  });
});
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 4.2 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-4.2</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-4.2"/>
        <updated>2021-12-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[å…ƒç»„ç±»å‹ä¸­çš„å‰å¯¼ / ä¸­é—´å‰©ä½™å…ƒç´ ]]></summary>
        <content type="html"><![CDATA[<h2>å…ƒç»„ç±»å‹ä¸­çš„å‰å¯¼ / ä¸­é—´å‰©ä½™å…ƒç´ </h2><p>æ¯ä¸ªå…ƒç»„åªæœ‰ä¸€ä¸ªå‰©ä½™å…ƒç´ ï¼Œå¹¶ä¸”å‰©ä½™å…ƒç´ åé¢ä¸èƒ½æœ‰å¯é€‰å…ƒç´ ã€‚</p><pre><code class="language-typescript">interface Clown {
  /*...*/
}
interface Joker {
  /*...*/
}
let StealersWheel: [...Clown[], &quot;me&quot;, ...Joker[]];
// ~~~~~~~~~~ Error!
// A rest element cannot follow another rest element.
let StringsAndMaybeBoolean: [...string[], boolean?];
// ~~~~~~~~ Error!
// An optional element cannot follow a rest element.
</code></pre><p>è¿™äº›æ²¡æœ‰åç¼€çš„å‰©ä½™å…ƒç´ å¯ä»¥è¢«ç”¨æ¥å¯¹é‡‡ç”¨ä»»æ„æ•°é‡çš„å‰å¯¼å‚æ•°ï¼ˆåé¢è·Ÿå‡ ä¸ªå›ºå®šå‚æ•°ï¼‰çš„å‡½æ•°è¿›è¡Œå»ºæ¨¡ã€‚</p><pre><code class="language-typescript">declare function doStuff(...args: [...names: string[], shouldCapitalize: boolean]): void;
doStuff(/*shouldCapitalize:*/ false)
doStuff(&quot;fee&quot;, &quot;fi&quot;, &quot;fo&quot;, &quot;fum&quot;, /*shouldCapitalize:*/ true);
</code></pre><h2>é’ˆå¯¹ in æ“ä½œç¬¦çš„æ›´ä¸¥æ ¼çš„æ£€æŸ¥</h2><p>åœ¨ JavaScript ä¸­ï¼Œåœ¨ in æ“ä½œç¬¦å³ä¾§ä½¿ç”¨ä¸€ä¸ªéå¯¹è±¡ç±»å‹æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ã€‚TypeScript 4.2 ç¡®ä¿è¿™å¯ä»¥åœ¨è®¾è®¡æ—¶å‘ç°è¿™ä¸ªé”™è¯¯ã€‚</p><pre><code class="language-typescript">&quot;foo&quot; in 42;
// ~~
// error! The right-hand side of an &#x27;in&#x27; expression must not be a primitive.
</code></pre><h2>è§£æ„å˜é‡å¯ä»¥æ˜¾å¼æ ‡è®°ä¸ºæœªä½¿ç”¨</h2><p>ä½ ç°åœ¨å¯ä»¥é€šè¿‡åœ¨è§£æ„å˜é‡å‰å¢åŠ ä¸€ä¸ªä¸‹åˆ’çº¿ï¼ˆ<!-- -->_<!-- -->å­—ç¬¦ï¼‰ï¼Œæ¥å°†è§£æ„å˜é‡æ ‡è®°ä¸ºæœªä½¿ç”¨ã€‚</p><pre><code class="language-typescript">let [_first, second] = getValues();
</code></pre><p>ä»¥å‰ï¼Œå¦‚æœ<!-- -->_<!-- -->first ä»¥åä»æœªä½¿ç”¨è¿‡ï¼ŒTypeScript ä¼šæŠ¥ä¸€ä¸ª noUnusedLocals é”™è¯¯ã€‚ç°åœ¨ï¼ŒTypeScript å°†æ„è¯†åˆ°ï¼Œ<!-- -->_<!-- -->first æ˜¯æ•…æ„ç”¨ä¸‹åˆ’çº¿å‘½åçš„ï¼Œå› ä¸ºæ²¡æœ‰ä½¿ç”¨å®ƒçš„æ„å›¾ã€‚</p><h2>å¯é€‰å±æ€§å’Œå­—ç¬¦ä¸²ç´¢å¼•ç¬¦å·ä¹‹é—´çš„å®½æ¾è§„åˆ™</h2><p>TypeScript çš„æ—©æœŸç‰ˆæœ¬è®¤ä¸ºå¯¹è±¡çš„å¯é€‰å±æ€§ä¸èƒ½ç”¨å…¼å®¹ç´¢å¼•ç¬¦å·èµ‹å€¼ã€‚TypeScript 4.2 å…è®¸è¿™ç§èµ‹å€¼ã€‚
ä¸‹é¢çš„ä»£ç åœ¨ 4.2 ç‰ˆæœ¬ä¸­å¯ä»¥æ­£å¸¸è¿è¡Œ</p><pre><code class="language-typescript">type WesAndersonWatchCount = {
  &quot;Fantastic Mr. Fox&quot;?: number;
  &quot;The Royal Tenenbaums&quot;?: number;
  &quot;Moonrise Kingdom&quot;?: number;
  &quot;The Grand Budapest Hotel&quot;?: number;
};
declare const wesAndersonWatchCount: WesAndersonWatchCount;
const movieWatchCount: { [key: string]: number } = wesAndersonWatchCount;
// ~~~~~~~~~~~~~~~ error!
// Type &#x27;WesAndersonWatchCount&#x27; is not assignable to type &#x27;{ [key: string]: number; }&#x27;.
// Property &#x27;&quot;Fantastic Mr. Fox&quot;&#x27; is incompatible with index signature.
// Type &#x27;number | undefined&#x27; is not assignable to type &#x27;number&#x27;.
// Type &#x27;undefined&#x27; is not assignable to type &#x27;number&#x27;. (2322)
</code></pre><p>ç„¶è€Œï¼Œ4.2 ç‰ˆæœ¬ä¸­å­—ç¬¦ä¸²ç´¢å¼•ç±»å‹ä¸å…è®¸å¯¹ç±»å‹ä¸­ undefined çš„éå¯é€‰å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œä¹Ÿä¸å…è®¸å°† undefined å†™åˆ°ç‰¹å®šé”®ï¼š</p><pre><code class="language-typescript">type BatmanWatchCount = {
  &quot;Batman Begins&quot;: number | undefined;
  &quot;The Dark Knight&quot;: number | undefined;
  &quot;The Dark Knight Rises&quot;: number | undefined;
};
declare const batmanWatchCount: BatmanWatchCount;
// Still an error in TypeScript 4.2.
// `undefined` is only ignored when properties are marked optional.
const movieWatchCount: { [key: string]: number } = batmanWatchCount;
// Still an error in TypeScript 4.2.
// Index signatures don&#x27;t implicitly allow explicit `undefined`.
movieWatchCount[&quot;It&#x27;s the Great Pumpkin, Charlie Brown&quot;] = undefined;
</code></pre><p>æ–°è§„åˆ™ä¹Ÿä¸é€‚ç”¨äºæ•°å­—ç´¢å¼•ç¬¦å·ï¼Œå› ä¸ºå®ƒä»¬è¢«å‡å®šä¸ºç±»ä¼¼æ•°ç»„ä¸”å¯†é›†çš„ï¼š</p><pre><code class="language-typescript">declare let sortOfArrayish: { [key: number]: string };
declare let numberKeys: { 42?: string };
// Error! Type &#x27;{ 42?: string | undefined; }&#x27; is not assignable to type &#x27;{ [key: number]: string; }&#x27;.
sortOfArrayish = numberKeys;
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 4.3 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-4.3</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-4.3"/>
        <updated>2021-12-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[override å’Œ --noImplicitOverride æ ‡å¿—]]></summary>
        <content type="html"><![CDATA[<h2>override å’Œ --noImplicitOverride æ ‡å¿—</h2><p>å½“ä¸€ä¸ªæ–¹æ³•è¢«æ ‡è®°ä¸º override æ—¶ï¼ŒTypeScript å°†å§‹ç»ˆç¡®ä¿åŸºç±»ä¸­å­˜åœ¨ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°çš„æ–¹æ³•ã€‚</p><pre><code class="language-typescript">class SomeComponent {
  setVisible(value: boolean) {
    // ...
  }
}
class SpecializedComponent extends SomeComponent {
  override show() {
  // ~~~~~~~~
  // Error! This method can&#x27;t be marked with &#x27;override&#x27; because it&#x27;s not declared in &#x27;SomeComponent&#x27;.
  // ...
  }
  // ...
}
</code></pre><p>TypeScript 4.3 è¿˜æä¾›äº†ä¸€ä¸ªæ–°çš„ --noImplicitOverride æ ‡å¿—ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œé™¤éä½ æ˜¾å¼ä½¿ç”¨ä¸€ä¸ª override å…³é”®å­—ï¼Œå¦åˆ™é‡å†™ä¸€ä¸ªè¶…ç±»ä¸­çš„ä»»ä½•æ–¹æ³•å°†ç”Ÿæˆé”™è¯¯ã€‚</p><h2>æ°¸è¿œ truthy çš„ promise æ£€æŸ¥</h2><p>åœ¨ strictNullChecks ä¸‹ï¼Œæ£€æŸ¥ä¸€ä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ª Promise æ˜¯å¦â€œçœŸå®â€ä¼šè§¦å‘é”™è¯¯ã€‚</p><pre><code class="language-typescript">async function foo(): Promise&lt;boolean&gt; {
  return false;
}
async function bar(): Promise&lt;string&gt; {
  if (foo()) {
    // ~~~~~
    // Error!
    // This condition will always return true since
    // this &#x27;Promise&lt;boolean&gt;&#x27; appears to always be defined.
    // Did you forget to use &#x27;await&#x27;?
    return &quot;true&quot;;
  }
  return &quot;false&quot;;
}
</code></pre><h2>static ç´¢å¼•ç­¾å</h2><p>ç´¢å¼•ç­¾åä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªå€¼ä¸Šè®¾ç½®æ¯”ä¸€ä¸ªç±»å‹æ˜¾å¼å£°æ˜æ›´å¤šçš„å±æ€§ã€‚</p><pre><code class="language-typescript">class Foo {
  hello = &quot;hello&quot;;
  world = 1234;
  // This is an index signature:
  [propName: string]: string | number | undefined;
}
let instance = new Foo();
// Valid assigment
instance[&quot;whatever&quot;] = 42;
// Has type &#x27;string | number | undefined&#x27;.
let x = instance[&quot;something&quot;];
</code></pre><p>ä¹‹å‰ï¼Œç´¢å¼•ç­¾ååªèƒ½åœ¨ç±»çš„å®ä¾‹ä¾§å£°æ˜ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†ç´¢å¼•ç­¾åå£°æ˜ä¸º staticã€‚</p><pre><code class="language-typescript">class Foo {
  static hello = &quot;hello&quot;;
  static world = 1234;
  static [propName: string]: string | number | undefined;
}
// Valid.
Foo[&quot;whatever&quot;] = 42;
// Has type &#x27;string | number | undefined&#x27;
let x = Foo[&quot;something&quot;];
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 4.4 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-4.4</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-4.4"/>
        <updated>2021-12-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ç”¨äº Aliased æ¡ä»¶çš„æ§åˆ¶æµåˆ†æ]]></summary>
        <content type="html"><![CDATA[<h2>ç”¨äº Aliased æ¡ä»¶çš„æ§åˆ¶æµåˆ†æ</h2><pre><code class="language-typescript">function foo(arg: unknown) {
  if (typeof arg === &quot;string&quot;) {
    // We know this is a string now.
    console.log(arg.toUpperCase());
  }
}
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥äº† arg æ˜¯å¦æ˜¯ä¸€ä¸ª stringã€‚TypeScript è¯†åˆ«äº† typeof arg === &quot;string&quot;è¿™ä¸ªæ£€æŸ¥ï¼Œè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªç±»å‹ä¿æŠ¤ï¼Œå¹¶ä¸”èƒ½å¤Ÿç¡®å®š arg åº”è¯¥æ˜¯ if å—ä¸»ä½“ä¸­çš„ä¸€ä¸ª stringã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°†æ¡ä»¶ç§»å‡ºä¸ºä¸€ä¸ªå¸¸é‡ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><pre><code class="language-typescript">function foo(arg: unknown) {
  const argIsString = typeof arg === &quot;string&quot;;
  if (argIsString) {
    console.log(arg.toUpperCase());
    //              ~~~~~~~~~~~
    // Error! Property &#x27;toUpperCase&#x27; does not exist on type &#x27;unknown&#x27;.
  }
}
</code></pre><p>åœ¨ä»¥å‰çš„ TypeScript ç‰ˆæœ¬ä¸­ï¼Œè¿™å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯â€”â€”å³ä½¿ argIsString è¢«åˆ†é…äº†ç±»å‹ä¿æŠ¤çš„å€¼ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒTypeScript æŠŠè¿™äº›ä¿¡æ¯ä¸¢æ‰äº†ã€‚è¿™ä¼šå¾ˆéº»çƒ¦ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½æƒ³åœ¨å¤šä¸ªä½ç½®é‡å¤ä½¿ç”¨ç›¸åŒçš„æ£€æŸ¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨æˆ·å¾€å¾€éœ€è¦é‡å¤è‡ªå·±åšè¿‡çš„äº‹æƒ…æˆ–ä½¿ç”¨ç±»å‹æ–­è¨€ï¼ˆcastï¼‰ã€‚åœ¨ TypeScript 4.4 ä¸­æƒ…å†µä¸å†å¦‚æ­¤äº†ã€‚ä¸Šé¢çš„ä¾‹å­ä¸ä¼šå†æŠ›å‡ºé”™è¯¯ï¼å½“ TypeScript çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨æµ‹è¯•ä¸€ä¸ªå¸¸é‡å€¼æ—¶ï¼Œå®ƒä¼šåšä¸€äº›é¢å¤–çš„å·¥ä½œæ¥çœ‹çœ‹å®ƒæ˜¯å¦åŒ…å«ç±»å‹ä¿æŠ¤ã€‚å¦‚æœè¿™ä¸ªç±»å‹ä¿æŠ¤å¯¹ constã€readonly å±æ€§æˆ–æœªä¿®æ”¹çš„å‚æ•°è¿›è¡Œæ“ä½œï¼Œåˆ™ TypeScript èƒ½å¤Ÿé€‚å½“åœ°ç¼©å°è¯¥å€¼ã€‚
æ–°ç‰ˆä¿ç•™äº†å„ç§ç±»å‹ä¿æŠ¤æ¡ä»¶â€”â€”ä¸ä»…ä»…æ˜¯ typeof æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œå¯è¾¨è¯†è”åˆç±»å‹ç°åœ¨å¾ˆå®¹æ˜“æ£€æŸ¥äº†ã€‚</p><pre><code class="language-typescript">type Shape =
  | { kind: &quot;circle&quot;; radius: number }
  | { kind: &quot;square&quot;; sideLength: number };

function area(shape: Shape): number {
  const isCircle = shape.kind === &quot;circle&quot;;
  if (isCircle) {
    // We know we have a circle here!
    return Math.PI * shape.radius ** 2;
  } else {
    // We know we&#x27;re left with a square here!
    return shape.sideLength ** 2;
  }
}
</code></pre><h2>ç¬¦å·å’Œæ¨¡æ¿å­—ç¬¦ä¸²æ¨¡å¼ç´¢å¼•ç­¾å</h2><p>ç´¢å¼•ç­¾åéå¸¸æœ‰ç”¨,ç„¶è€Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒä»¬ä»…é™äº string å’Œ number é”®ï¼ˆå¹¶ä¸” string ç´¢å¼•ç­¾åæœ‰ä¸€ä¸ªäººä¸ºçš„æ€ªç™–ï¼Œå®ƒä»¬å¯ä»¥æ¥å— number é”®ï¼Œå› ä¸ºæ— è®ºå¦‚ä½•å®ƒä»¬éƒ½ä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼‰ã€‚è¿™æ„å‘³ç€ TypeScript ä¸å…è®¸ä½¿ç”¨ symbol é”®ç´¢å¼•å¯¹è±¡ã€‚TypeScript ä¹Ÿæ— æ³•å¯¹æŸäº› string é”®çš„å­é›†å»ºæ¨¡ç´¢å¼•ç­¾å
TypeScript 4.4 è§£å†³äº†è¿™äº›é™åˆ¶ï¼Œå¹¶å…è®¸ symbol å’Œæ¨¡æ¿å­—ç¬¦ä¸²æ¨¡å¼çš„ç´¢å¼•ç­¾åã€‚</p><pre><code class="language-typescript">interface Colors {
  [sym: symbol]: number;
}
const red = Symbol(&quot;red&quot;);
const green = Symbol(&quot;green&quot;);
const blue = Symbol(&quot;blue&quot;);
let colors: Colors = {};
colors[red] = 255; // Assignment of a number is allowed
let redVal = colors[red]; // &#x27;redVal&#x27; has the type &#x27;number&#x27;
colors[blue] = &quot;da ba dee&quot;; // Error: Type &#x27;string&#x27; is not assignable to type &#x27;number&#x27;.
</code></pre><p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æ¨¡å¼ç±»å‹ç¼–å†™ç´¢å¼•ç­¾åã€‚è¿™ç§åšæ³•çš„ä¸€ç§å¯èƒ½ç”¨é€”æ˜¯ä» TypeScript çš„å¤šä½™å±æ€§æ£€æŸ¥ä¸­æ’é™¤ä»¥ data-å¼€å¤´çš„å±æ€§ã€‚</p><pre><code class="language-typescript">interface Options {
    width?: number;
    height?: number;
}
let a: Options = {
    width: 100,
    height: 100,
    &quot;data-blah&quot;: true, // Error! &#x27;data-blah&#x27; wasn&#x27;t declared in &#x27;Options&#x27;.
};
interface OptionsWithDataProps extends Options {
    // Permit any property starting with &#x27;data-&#x27;.
    [optName: `data-${string}`]: unknown;
}
let b: OptionsWithDataProps = {
    width: 100,
    height: 100,
    &quot;data-blah&quot;: true,       // Works!
    &quot;unknown-property&quot;: true,  // Error! &#x27;unknown-property&#x27; wasn&#x27;t declared in &#x27;OptionsWithDataProps&#x27;.
};
</code></pre><p>å…³äºç´¢å¼•ç­¾åæœ€åè¿˜è¦æä¸€ä¸‹ï¼Œå®ƒä»¬ç°åœ¨å…è®¸è”åˆç±»å‹ï¼š</p><ul><li>string</li><li>number</li><li>symbol</li><li>æ¨¡æ¿å­—ç¬¦ä¸²æ¨¡å¼ï¼ˆä¾‹å¦‚ hello-\${string}ï¼‰</li></ul><p>å¦‚æœä¸€ä¸ªç´¢å¼•ç­¾åçš„å‚æ•°æ˜¯è¿™äº›ç±»å‹çš„è”åˆï¼Œå®ƒå°†æ‰å¹³åŒ–ä¸ºå‡ ä¸ªä¸åŒçš„ç´¢å¼•ç­¾åã€‚</p><pre><code class="language-typescript">interface Data {
  [optName: string | symbol]: any;
}
// Equivalent to
interface Data {
  [optName: string]: any;
  [optName: symbol]: any;
}
</code></pre><h2>ç²¾ç¡®çš„å¯é€‰å±æ€§ç±»å‹ï¼ˆ--exactOptionalPropertyTypesï¼‰</h2><pre><code class="language-typescript">interface Person {
  name: string;
  age?: number;
}
</code></pre><p>ç­‰ä»·äº</p><pre><code class="language-typescript">interface Person {
  name: string;
  age: number | undefined;
}
</code></pre><p>è¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥æ˜¾å¼ç”¨ undefined ä»£æ›¿ ageã€‚</p><pre><code class="language-typescript">const p: Person = {
  name: &quot;Daniel&quot;,
  age: undefined // This is okay by default.
};
</code></pre><p>åœ¨ TypeScript 4.4 ä¸­æ–°åŠ å…¥çš„æ ‡å¿—--exactOptionalPropertyTypes æŒ‡å®šäº†å¯é€‰å±æ€§ç±»å‹åº”å®Œå…¨æŒ‰ç…§ç¼–å†™çš„æ–¹å¼æ¥è§£é‡Šï¼Œè¿™æ„å‘³ç€|undefined ä¸ä¼šæ·»åŠ åˆ°ç±»å‹ä¸­ï¼š</p><pre><code class="language-typescript">// With &#x27;exactOptionalPropertyTypes&#x27; on:
const p: Person = {
  name: &quot;Daniel&quot;,
  age: undefined // Error! undefined isn&#x27;t a number
};
</code></pre><p>è¿™ä¸ªæ ‡å¿—ä¸æ˜¯--strict ç³»åˆ—çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœä½ æƒ³è¦è¿™ç§è¡Œä¸ºï¼Œéœ€è¦æ˜¾å¼æ‰“å¼€å®ƒã€‚å®ƒè¿˜éœ€è¦å¯ç”¨--strictNullChecksã€‚</p><h2>æŠ½è±¡å±æ€§ä¸å…è®¸åˆå§‹åŒ–</h2><pre><code class="language-typescript">abstract class C {
  abstract prop = 1;
  //       ~~~~
  // Property &#x27;prop&#x27; cannot have an initializer because it is marked abstract.
}
</code></pre><p>ç›¸åï¼Œä½ åªèƒ½ä¸ºè¿™ä¸ªå±æ€§æŒ‡å®šä¸€ä¸ªç±»å‹ï¼š</p><pre><code class="language-typescript">abstract class C {
  abstract prop: number;
}
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 4.5 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-4.5</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-4.5"/>
        <updated>2021-12-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Awaited ç±»å‹ä¸ Promise æ”¹è¿›]]></summary>
        <content type="html"><![CDATA[<h2>Awaited ç±»å‹ä¸ Promise æ”¹è¿›</h2><p>TypeScript 4.5 å¼•å…¥äº†ä¸€ç§æ–°çš„å®ç”¨ç¨‹åºç±»å‹ï¼š Awaited ç±»å‹ï¼Œè·å– promise çš„è¿”å›å€¼ç±»å‹</p><ul><li>é€’å½’è§£åŒ…</li><li>ä¸ä¾èµ– PromiseLike æ›´ç¨³å¥</li><li>åˆ©ç”¨ <code>Awaited&lt;T&gt;</code> ï¼Œä¸º <code>Promise.all</code> ã€ <code>Promise.race</code> ã€ <code>Promise.allSettled</code> å’Œ <code>Promise.any</code> å¢åŠ é‡è½½</li></ul><pre><code class="language-typescript">// type is string
type basic = Awaited&lt;Promise&lt;string&gt;&gt;;
// type is string
type recursive = Awaited&lt;Promise&lt;Promise&lt;string&gt;&gt;&gt;;
// type is boolean
type nonThenObj = Awaited&lt;boolean&gt;;
// type is string | Date
type unions = Awaited&lt;Date | Promise&lt;Promise&lt;string&gt;&gt;&gt;;
type FakePromise = { then: () =&gt; string };
// type is never
type fake = Awaited&lt;FakePromise&gt;;
</code></pre><h2>å…¶ä»–æ–°ç‰¹æ€§</h2><ul><li><p>å¼•å…¥ es2022 æ¨¡å—ï¼šTypeScript ç°åœ¨æ”¯æŒä¸€ä¸ªæ–°çš„æ¨¡å—è®¾ç½®ï¼šes2022ã€‚es2022 æ¨¡å—çš„ä¸»è¦åŠŸèƒ½æ˜¯é¡¶å±‚ awaitï¼Œæ„å‘³ç€å¼€å‘è€…å¯ä»¥åœ¨ async å‡½æ•°ä¹‹å¤–ä½¿ç”¨ awaitã€‚è¿™åœ¨æ¨¡å— esnextï¼ˆä»¥åŠç°åœ¨çš„æ¨¡å— nodenextï¼‰ä¸­å·²ç»å¾—åˆ°æ”¯æŒï¼Œä½† es2022 æ˜¯è¿™ä¸ªåŠŸèƒ½çš„ç¬¬ä¸€ä¸ªç¨³å®šç›®æ ‡ã€‚</p></li><li><p>æ”¯æŒ import æ–­è¨€ï¼šTypeScript 4.5 æ”¯æŒ ECMAScript å…³äºå¯¼å…¥æ–­è¨€çš„æè®®ï¼Œè¿™æ˜¯è¿è¡Œæ—¶ä½¿ç”¨çš„ä¸€ç§è¯­æ³•ï¼Œä»¥ç¡®ä¿å¯¼å…¥æœ‰ä¸€ä¸ªé¢„æœŸçš„æ ¼å¼ã€‚</p></li><li><p>ç§æœ‰å­—æ®µæ£€æŸ¥ï¼šå¼€å‘äººå‘˜ç°åœ¨å¯ä»¥ç¼–å†™ä¸€ä¸ªå…·æœ‰ #private å­—æ®µæˆå‘˜çš„ç±»ï¼Œå¹¶ä½¿ç”¨ in è¿ç®—ç¬¦æŸ¥çœ‹å¦ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å…·æœ‰ç›¸åŒçš„å­—æ®µï¼Œä»¥ç”¨äºæ£€æŸ¥å¯¹è±¡ä¸Šæ˜¯å¦å…·æœ‰ç§æœ‰å­—æ®µã€‚</p></li></ul>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 3.7 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-3.7</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-3.7"/>
        <updated>2021-12-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[å†™åœ¨å‰é¢]]></summary>
        <content type="html"><![CDATA[<h2>å†™åœ¨å‰é¢</h2><p>ä¸æ˜¯å®Œæ•´çš„ç‰ˆæœ¬æ–°ç‰¹æ€§ï¼Œè¿™é‡Œåªå†™å‡ºäº†æˆ‘è§‰å¾—å¸¸ç”¨çš„æ–°ç‰¹æ€§</p><h2>å¯é€‰é“¾å¼è¿ç®—ç¬¦ ?.</h2><p>js ä¹Ÿæ”¯æŒäº†è¿™ä¸ªç‰¹æ€§</p><p><code>obj?.prop</code> å½“ obj ä¸º null/undefined å¼ç›´æ¥è¿”å› undefinedï¼Œå¯ä»¥ç”¨æ¥ä»£æ›¿<code>obj &amp;&amp; obj.prop</code></p><pre><code class="language-typescript">// Before
if (foo &amp;&amp; foo.bar &amp;&amp; foo.bar.baz) {
  // ...
}

// After-ish
if (foo?.bar?.baz) {
  // ...
}
</code></pre><ul><li>å¯ä»¥ç”¨äºè®¿é—®æ•°ç»„æˆ–è€…å¼å¯¹è±¡ç´¢å¼•</li></ul><pre><code class="language-typescript">arr?.[1];
const name = &quot;name&quot;;
obj?.[name];
</code></pre><ul><li>å¯ä»¥ç”¨äºå‡½æ•°è°ƒç”¨</li></ul><pre><code class="language-typescript">obj.func?.(123);
</code></pre><h2>ç©ºåˆå¹¶è¿ç®—ç¬¦ ??</h2><p><code>a ?? b</code> å½“ a ä¸º null/undefined çš„æ—¶å€™è¿”å› bï¼Œå…¶ä½™è¿”å› a</p><h3>?? å’Œ &amp;&amp; çš„åŒºåˆ«</h3><p><code>&amp;&amp;</code>è¿ç®—ç¬¦å½“å‰é¢çš„å˜é‡å¼å‡å€¼ï¼ˆfalse/0/null/undefined/NaN/&#x27;&#x27;ï¼‰å¼éƒ½ä¼šè¿”å›åé¢çš„å˜é‡ï¼Œæœ‰æ—¶å€™è¿™å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼›<code>??</code>åˆ™åªä¼šè¿‡æ»¤ null å’Œ undefined</p><h2>type çš„æ‰©å±•ä½¿ç”¨</h2><ul><li>type ç±»å‹å®šä¹‰æ—¶å¯ä»¥ä½¿ç”¨è‡ªå·±</li></ul><pre><code class="language-typescript">type Json =
  | string
  | number
  | boolean
  | null
  | { [property: string]: Json }
  | Json[];
</code></pre><h2>æ–­è¨€æ‰©å±•</h2><p>throw å¦‚æœå‘ç”Ÿæ„å¤–æƒ…å†µï¼Œåˆ™æœ‰ä¸€ç»„ç‰¹å®šçš„å‡½æ•°ä¼šå‡ºé”™ã€‚å®ƒä»¬è¢«ç§°ä¸ºâ€œæ–­è¨€â€åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼ŒNode.js ä¸ºæ­¤æœ‰ä¸€ä¸ªä¸“ç”¨åŠŸèƒ½ assertã€‚</p><pre><code class="language-javascript">assert(someValue === 42);
</code></pre><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ someValue ä¸ç­‰äº 42ï¼Œassert åˆ™å°†æŠ›å‡º AssertionErrorã€‚</p><p>JavaScript ä¸­çš„æ–­è¨€é€šå¸¸ç”¨äºé˜²æ­¢ä¼ å…¥ä¸æ­£ç¡®çš„ç±»å‹ã€‚ä¾‹å¦‚:</p><pre><code class="language-javascript">function multiply(x, y) {
  assert(typeof x === &quot;number&quot;);
  assert(typeof y === &quot;number&quot;);

  return x * y;
}
</code></pre><p>TypeScript 3.7 å¼•å…¥äº†ä¸€ä¸ªç§°ä¸ºâ€œæ–­è¨€ç­¾åâ€çš„æ–°æ¦‚å¿µï¼Œå¯ä»¥å¯¹è¿™äº›æ–­è¨€å‡½æ•°è¿›è¡Œå»ºæ¨¡ã€‚
ç¡®ä¿åœ¨åŒ…å«èŒƒå›´çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæ— è®ºæ£€æŸ¥ä»€ä¹ˆæ¡ä»¶éƒ½å¿…é¡»ä¸ºçœŸã€‚</p><pre><code class="language-typescript">function assert(condition: any, msg?: string): asserts condition {
  if (!condition) {
    throw new TypeError(msg);
  }
}
</code></pre><pre><code class="language-typescript">function yell(str) {
  assert(typeof str === &quot;string&quot;);

  return str.toUppercase();
  //         ~~~~~~~~~~~
  // error: Property &#x27;toUppercase&#x27; does not exist on type &#x27;string&#x27;.
  //        Did you mean &#x27;toUpperCase&#x27;?
}

function assert(condition: any, msg?: string): asserts condition {
  if (!condition) {
    throw new TypeError(msg);
  }
}
</code></pre><p>æ–­è¨€ç­¾åçš„å¦ä¸€ç§ç±»å‹ä¸æ£€æŸ¥æ¡ä»¶ï¼Œè€Œæ˜¯å‘Šè¯‰ TypeScript ç‰¹å®šçš„å˜é‡æˆ–å±æ€§å…·æœ‰ä¸åŒçš„ç±»å‹ã€‚å…¶ä½™èŒƒå›´å†… val ä¸€å®šæ˜¯ stringï¼Œç±»ä¼¼äºç±»å‹å®ˆå«</p><pre><code class="language-typescript">function assertIsString(val: any): asserts val is string {
  if (typeof val !== &quot;string&quot;) {
    throw new TypeError(&quot;Not a string!&quot;);
  }
}
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 3.8 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-3.8</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-3.8"/>
        <updated>2021-12-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ç±»å‹é™åˆ¶çš„å¯¼å…¥å¯¼å‡ºæ–¹æ³• (Type-Only Imports and Export)]]></summary>
        <content type="html"><![CDATA[<h2>ç±»å‹é™åˆ¶çš„å¯¼å…¥å¯¼å‡ºæ–¹æ³• (Type-Only Imports and Export)</h2><p>TypeScript 3.8 ä¸ºä»…ç±»å‹å¯¼å…¥å’Œå¯¼å‡ºæ·»åŠ äº†æ–°è¯­æ³•ã€‚æ­¤æ—¶å¯¼å…¥ã€å¯¼å‡ºçš„å˜é‡åªèƒ½ä½œä¸ºç±»å‹ä½¿ç”¨</p><pre><code class="language-typescript">import type { SomeThing } from &quot;./some-module.js&quot;;

export type { SomeThing };
</code></pre><pre><code class="language-typescript">import type { Component } from &quot;react&quot;;

interface ButtonProps {
    // ...
}

class Button extends Component&lt;ButtonProps&gt; {
    //               ~~~~~~~~~
    // error! &#x27;Component&#x27; only refers to a type, but is being used as a value here.

    // ...
}
</code></pre><h2>ECMAScript ææ¡ˆçš„ç§æœ‰å­—æ®µï¼ˆECMAScript Private Fieldsï¼‰</h2><h3>Private Fields çš„åŸºæœ¬ç‰¹æ€§</h3><ul><li><p>js ä¸­å·²ç»æœ‰ææ¡ˆï¼Œä½†æ˜¯æµè§ˆå™¨ä¸­è¿˜ä¸æ”¯æŒ</p></li><li><p>typescript ä¸­å·²ç»å¯ä»¥ä½¿ç”¨<code>#</code>æ¥å®šä¹‰çœŸæ­£çš„ç§æœ‰å±æ€§äº†</p></li></ul><pre><code class="language-typescript">class Person {
    #name: string

    constructor(name: string) {
        this.#name = name;
    }

    greet() {
        console.log(`Hello, my name is ${this.#name}!`);
    }
}

let jeremy = new Person(&quot;Jeremy Bearimy&quot;);

jeremy.#name
//     ~~~~~
// Property &#x27;#name&#x27; is not accessible outside class &#x27;Person&#x27;
// because it has a private identifier.
</code></pre><p>âš ï¸ å’Œå¸¸è§„å±æ€§(è¿™é‡Œç‰¹åˆ«æ¯”è¾ƒ private ä¿®é¥°ç¬¦å£°æ˜çš„æ¯”è¾ƒ)ä¸åŒï¼Œç§æœ‰å­—æ®µ(private fields)æ‹¥æœ‰ä¸‹é¢è¿™äº›ç‰¹æ€§ã€‚</p><ul><li>ä¸“ç”¨å­—æ®µä»¥ # å­—ç¬¦å¼€å¤´ã€‚æœ‰æ—¶æˆ‘ä»¬ç§°è¿™äº› prviate nameã€‚</li><li>æ¯ä¸ªä¸“ç”¨å­—æ®µåç§°éƒ½å”¯ä¸€åœ°é™å®šäºå…¶åŒ…å«çš„ç±»ã€‚</li><li>TypeScript è¾…åŠ©åŠŸèƒ½ä¿®é¥°ç¬¦ï¼Œä¾‹å¦‚ publicï¼Œprivate ä¸èƒ½åœ¨ç§æœ‰å­—æ®µä¸Šä½¿ç”¨ã€‚</li></ul><h3>Private Fields çš„ä½¿ç”¨è§„èŒƒ</h3><p>é™¤äº†èƒ½ä¿å­˜è‡ªå·±çš„ç§æœ‰è¿™ä¸€å±æ€§ä»¥å¤–ï¼Œç§æœ‰å­—æ®µçš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯æˆ‘ä»¬åˆšæ‰æåˆ°çš„å”¯ä¸€æ€§ã€‚ä¾‹å¦‚ï¼Œå¸¸è§„å±æ€§å£°æ˜æ˜“äºåœ¨å­ç±»ä¸­è¢«è¦†ç›–ã€‚è€Œ <code>private fields</code> æ˜¯å—ä¿æŠ¤çš„ã€‚</p><pre><code class="language-typescript">class C {
  foo = 10;

  cHelper() {
    return this.foo;
  }
}

class D extends C {
  foo = 20;

  dHelper() {
    return this.foo;
  }
}

let instance = new D();
// &#x27;this.foo&#x27; refers to the same property on each instance.
console.log(instance.cHelper()); // prints &#x27;20&#x27;
console.log(instance.dHelper()); // prints &#x27;20&#x27;
</code></pre><h3>é‚£æˆ‘ä»¬åˆ°åº•è¯¥ä½¿ç”¨ # å®šåˆ¶çš„ç§æœ‰å­—æ®µè¿˜æ˜¯ä½¿ç”¨ private ä¿®é¥°ç¬¦?</h3><p>å½“æ¶‰åŠåˆ°å±æ€§æ—¶ï¼ŒTypeScript çš„<code>private</code>ä¿®é¥°ç¬¦ä¼šå¹¶æ²¡æœ‰å®Œå…¨æ­£ç¡®çš„æ‰§è¡Œï¼Œå®ƒçš„è¡Œä¸ºå®Œå…¨åƒæ™®é€šå±æ€§ä¸€æ ·ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <code>soft privacy</code>, æˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡ <code>[&#x27;foo&#x27;]</code> è¿™æ ·çš„å½¢å¼è®¿é—®åˆ°ã€‚çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class="language-typescript">class C {
  private foo = 10;
}

// This is an error at compile time,
// but when TypeScript outputs .js files,
// it&#x27;ll run fine and print &#x27;10&#x27;.
console.log(new C().foo); // prints &#x27;10&#x27;
//                  ~~~
// error! Property &#x27;foo&#x27; is private and only accessible within class &#x27;C&#x27;.

// TypeScript allows this at compile-time
// as a &quot;work-around&quot; to avoid the error.
console.log(new C()[&quot;foo&quot;]); // prints &#x27;10&#x27;
</code></pre><p>å¯¹æ¯”ä¸‹é¢ä½¿ç”¨ <code>#</code> ç§æœ‰å­—æ®µï¼Œæ˜¯å®Œå…¨è®¿é—®ä¸åˆ°çš„</p><pre><code class="language-typescript">class C {
    #foo = 10;
}

console.log(new C().#foo); // SyntaxError
//                  ~~~~
// TypeScript reports an error *and*
// this won&#x27;t work at runtime!

console.log(new C()[&quot;#foo&quot;]); // prints undefined
//          ~~~~~~~~~~~~~~~
// TypeScript reports an error under &#x27;noImplicitAny&#x27;,
// and this prints &#x27;undefined&#x27;.
</code></pre><p><strong>ç»“è®ºå°±æ˜¯ï¼Œå¦‚æœä½ æƒ³ä¸¥æ ¼çš„ä¿æŠ¤æ‚¨çš„ç§æœ‰å±æ€§çš„å€¼ï¼Œå°±ä½¿ç”¨ <code>#</code> å³å¯ï¼Œå­ç±»ç»§æ‰¿çš„æ—¶å€™ä¹Ÿæ— éœ€æ‹…å¿ƒå‘½åå†²çªçš„é—®é¢˜ã€‚å½“æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ <code>private</code> çš„æ—¶å€™å°±éœ€è¦æ³¨æ„å¯¹ç§æœ‰ä¿®é¥°ç¬¦çš„å®šä¹‰çš„å€¼ä¿®æ”¹çš„é—®é¢˜äº†.</strong></p><h2>export <!-- -->*<!-- --> as xxx è¯­æ³•ä½¿ç”¨</h2><p>typescript ä¹Ÿæ”¯æŒè¿™ç§ç”¨æ³•å•¦ï¼Œåœ¨å¯¼å…¥æ¨¡å—çš„ as é‡æ–°å®šä¹‰æ¨¡å—åçš„æ¨¡å—çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°å¯¼å‡ºåˆ°å•ç‹¬æ¨¡å—åã€‚</p><p>menu.ts</p><pre><code class="language-typescript">export const MENU1 = &quot;nav: èœå• 1&quot;;
export const MENU2 = &quot;nav: èœå• 2&quot;;
export const MENU3 = &quot;nav: èœå• 3&quot;;
export const MENU4 = &quot;nav: èœå• 4&quot;;
export const DEMO = &quot;nav:Demo&quot;;
</code></pre><p>index.ts</p><pre><code class="language-typescript">import * as menu from &quot;./menu.ts&quot;;
console.log(menu.MENU1); // &#x27;nav: èœå• 1&#x27;ï¼›
console.log(menu.MENU2); // &#x27;nav: èœå• 2&#x27;ï¼›
// ....

export { menu };
</code></pre><h3><code>import * as React from &#x27;react&#x27;; vs import React from &#x27;react&#x27;;</code> è¿™ä¸¤ä¸ªä½¿ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«?</h3><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ <code>import React from &#x27;react&#x27;</code> å…¶å®æ˜¯å¯¼å‡ºçš„é»˜è®¤çš„æ¨¡å—ï¼Œè€Œç”¨åˆ° <code>* as</code> æ˜¯å¯¼å‡ºå…¨éƒ¨æ¨¡å—ã€‚</p><h2>é¡¶å±‚ await ä½¿ç”¨</h2><p>js ä¹Ÿæ”¯æŒå•¦ ğŸ˜„</p><pre><code class="language-typescript">const response = await fetch(&quot;...&quot;);
const greeting = await response.text();
console.log(greeting);

// Make sure we&#x27;re a module
export {};
</code></pre><blockquote><p>æ³¨æ„ï¼šé¡¶å±‚ await åªä¼šåœ¨æ¨¡å—ä¸­èµ·ä½œç”¨ï¼Œåœ¨éæ¨¡å—æ–‡ä»¶ä¸­ä½¿ç”¨ä¼šæŠ¥é”™ã€‚é¡¶å±‚ await ä»…åœ¨æ¨¡å—çš„é¡¶å±‚èµ·ä½œç”¨ï¼Œå¹¶ä¸”åªæœ‰å½“ TypeScript æ‰¾åˆ°ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„æ¨¡å—æ‰å…è®¸ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª export {} æ¥æ£€æµ‹æ˜¯å¦åœ¨æ¨¡å—ä¸‹ä½¿ç”¨ã€‚</p></blockquote><pre><code class="language-typescript">const response = await fetch(&quot;...&quot;);
const greeting = await response.text();
console.log(greeting);

// &#x27;await&#x27; expressions are only allowed at the top level of a file when that file is a module, but this file has no imports or exports. Consider adding an empty &#x27;export {}&#x27; to make this file a module.
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 3.9 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-3.9</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-3.9"/>
        <updated>2021-12-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[å†™åœ¨å‰é¢]]></summary>
        <content type="html"><![CDATA[<h2>å†™åœ¨å‰é¢</h2><p>æŒ‘é‡ç‚¹çš„è®²ä¸€è®²</p><h2>åœ¨æ¡ä»¶è¯­å¥ä¸­æ£€æµ‹æœªè°ƒç”¨çš„å‡½æ•°</h2><ul><li>åœ¨ 3.7 çš„æ—¶å€™å¼•å…¥äº†æ£€æµ‹æœªè°ƒç”¨å‡½æ•°é”™è¯¯æç¤ºï¼Œ3.9 åšäº†éƒ¨åˆ†ä¼˜åŒ–</li></ul><pre><code class="language-typescript">function hasImportantPermissions(): boolean {
  // ...
}
// Oops!
if (hasImportantPermissions) {
  //  ~~~~~~~~~~~~~~~~~~~~~~~
  // This condition will always return true since the function is always defined.
  // Did you mean to call it instead?
  deleteAllTheImportantFiles();
}
</code></pre><p>ä½†æ˜¯ï¼Œæ­¤é”™è¯¯ä»…é€‚ç”¨äº if è¯­å¥ä¸­çš„æ¡ä»¶ã€‚ç°åœ¨ä¸‰å…ƒæ¡ä»¶ï¼ˆå³è¯­æ³•ï¼‰ç°åœ¨ä¹Ÿæ”¯æŒæ­¤åŠŸèƒ½ã€‚</p><pre><code class="language-typescript">declare function listFilesOfDirectory(dirPath: string): string[];
declare function isDirectory(): boolean;
function getAllFiles(startFileName: string) {
  const result: string[] = [];
  traverse(startFileName);
  return result;
  function traverse(currentPath: string) {
    return isDirectory
      ? //     ~~~~~~~~~~~
        // This condition will always return true
        // since the function is always defined.
        // Did you mean to call it instead?
        listFilesOfDirectory(currentPath).forEach(traverse)
      : result.push(currentPath);
  }
}
</code></pre><h2>è§£æå¯é€‰é“¾ä¸é null æ–­è¨€ä¸­çš„å·®å¼‚</h2><ul><li>TypeScript æœ€è¿‘å®ç°äº†å¯¹å¯é€‰é“¾æ“ä½œç¬¦çš„æ”¯æŒï¼Œä½†æ ¹æ®å¹¿å¤§ä½¿ç”¨è€…çš„åé¦ˆï¼Œé null æ–­è¨€æ“ä½œç¬¦ï¼ˆ!ï¼‰çš„å¯é€‰é“¾ï¼ˆ?.ï¼‰è¡Œä¸ºä¸ç¬¦åˆç›´è§‰ã€‚</li></ul><pre><code class="language-typescript">foo?.bar!.baz;
</code></pre><p>è¢«è§£é‡Šä¸ºç­‰æ•ˆäºä»¥ä¸‹ JavaScript ä»£ç ï¼š</p><pre><code class="language-javascript">(foo?.bar).baz;
</code></pre><blockquote><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæ‹¬å·ä¼šé˜»æ­¢å¯é€‰é“¾çš„â€œçŸ­è·¯â€è¡Œä¸ºï¼›å› æ­¤å¦‚æœæœªå®šä¹‰ foo ä¸º undefinedï¼Œåˆ™è®¿é—® baz ä¼šå¼•å‘è¿è¡Œæ—¶é”™è¯¯ã€‚</p></blockquote><p>æ¢å¥è¯è¯´ï¼Œå¤§å¤šæ•°äººè®¤ä¸ºä»¥ä¸ŠåŸå§‹ä»£ç ç‰‡æ®µåº”è¯¥è¢«è§£é‡Šä¸ºåœ¨ï¼š</p><pre><code class="language-typescript">foo?.bar.baz;
</code></pre><p>ä¸­ï¼Œå½“ foo ä¸º undefined æ—¶ï¼Œè®¡ç®—ç»“æœä¸º undefinedã€‚</p><p>è¿™æ˜¯ä¸€é¡¹é‡å¤§å˜åŒ–ï¼Œä½†æˆ‘ä»¬è®¤ä¸ºå¤§éƒ¨åˆ†ä»£ç åœ¨ç¼–å†™æ—¶éƒ½æ˜¯ä¸ºäº†è€ƒè™‘æ–°çš„è§£é‡Šåœºæ™¯ã€‚å¦‚æœæ‚¨å¸Œæœ›ç»§ç»­ä½¿ç”¨æ—§æœ‰è¡Œä¸ºï¼Œåˆ™å¯åœ¨!æ“ä½œç¬¦å·¦ä¾§æ·»åŠ æ‹¬å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>(foo?.bar)!.baz;
</code></pre>]]></content>
    </entry>
</feed>