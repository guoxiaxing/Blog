<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://guoxiaxing.github.io/Blog/typescript</id>
    <title>Try's Blog Blog</title>
    <updated>2021-12-05T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://guoxiaxing.github.io/Blog/typescript"/>
    <subtitle>Try's Blog Blog</subtitle>
    <icon>https://guoxiaxing.github.io/Blog/img/logo.jpeg</icon>
    <entry>
        <title type="html"><![CDATA[Typescript 3.7 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-3.7</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-3.7"/>
        <updated>2021-12-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[å†™åœ¨å‰é¢]]></summary>
        <content type="html"><![CDATA[<h2>å†™åœ¨å‰é¢</h2><p>ä¸æ˜¯å®Œæ•´çš„ç‰ˆæœ¬æ–°ç‰¹æ€§ï¼Œè¿™é‡Œåªå†™å‡ºäº†æˆ‘è§‰å¾—å¸¸ç”¨çš„æ–°ç‰¹æ€§</p><h2>å¯é€‰é“¾å¼è¿ç®—ç¬¦ ?.</h2><p>js ä¹Ÿæ”¯æŒäº†è¿™ä¸ªç‰¹æ€§</p><p><code>obj?.prop</code> å½“ obj ä¸º null/undefined å¼ç›´æ¥è¿”å› undefinedï¼Œå¯ä»¥ç”¨æ¥ä»£æ›¿<code>obj &amp;&amp; obj.prop</code></p><pre><code class="language-typescript">// Before
if (foo &amp;&amp; foo.bar &amp;&amp; foo.bar.baz) {
  // ...
}

// After-ish
if (foo?.bar?.baz) {
  // ...
}
</code></pre><ul><li>å¯ä»¥ç”¨äºè®¿é—®æ•°ç»„æˆ–è€…å¼å¯¹è±¡ç´¢å¼•</li></ul><pre><code class="language-typescript">arr?.[1];
const name = &quot;name&quot;;
obj?.[name];
</code></pre><ul><li>å¯ä»¥ç”¨äºå‡½æ•°è°ƒç”¨</li></ul><pre><code class="language-typescript">obj.func?.(123);
</code></pre><h2>ç©ºåˆå¹¶è¿ç®—ç¬¦ ??</h2><p><code>a ?? b</code> å½“ a ä¸º null/undefined çš„æ—¶å€™è¿”å› bï¼Œå…¶ä½™è¿”å› a</p><h3>?? å’Œ &amp;&amp; çš„åŒºåˆ«</h3><p><code>&amp;&amp;</code>è¿ç®—ç¬¦å½“å‰é¢çš„å˜é‡å¼å‡å€¼ï¼ˆfalse/0/null/undefined/NaN/&#x27;&#x27;ï¼‰å¼éƒ½ä¼šè¿”å›åé¢çš„å˜é‡ï¼Œæœ‰æ—¶å€™è¿™å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼›<code>??</code>åˆ™åªä¼šè¿‡æ»¤ null å’Œ undefined</p><h2>type çš„æ‰©å±•ä½¿ç”¨</h2><ul><li>type ç±»å‹å®šä¹‰æ—¶å¯ä»¥ä½¿ç”¨è‡ªå·±</li></ul><pre><code class="language-typescript">type Json =
  | string
  | number
  | boolean
  | null
  | { [property: string]: Json }
  | Json[];
</code></pre><h2>æ–­è¨€æ‰©å±•</h2><p>throw å¦‚æœå‘ç”Ÿæ„å¤–æƒ…å†µï¼Œåˆ™æœ‰ä¸€ç»„ç‰¹å®šçš„å‡½æ•°ä¼šå‡ºé”™ã€‚å®ƒä»¬è¢«ç§°ä¸ºâ€œæ–­è¨€â€åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼ŒNode.js ä¸ºæ­¤æœ‰ä¸€ä¸ªä¸“ç”¨åŠŸèƒ½ assertã€‚</p><pre><code class="language-javascript">assert(someValue === 42);
</code></pre><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ someValue ä¸ç­‰äº 42ï¼Œassert åˆ™å°†æŠ›å‡º AssertionErrorã€‚</p><p>JavaScript ä¸­çš„æ–­è¨€é€šå¸¸ç”¨äºé˜²æ­¢ä¼ å…¥ä¸æ­£ç¡®çš„ç±»å‹ã€‚ä¾‹å¦‚:</p><pre><code class="language-javascript">function multiply(x, y) {
  assert(typeof x === &quot;number&quot;);
  assert(typeof y === &quot;number&quot;);

  return x * y;
}
</code></pre><p>TypeScript 3.7 å¼•å…¥äº†ä¸€ä¸ªç§°ä¸ºâ€œæ–­è¨€ç­¾åâ€çš„æ–°æ¦‚å¿µï¼Œå¯ä»¥å¯¹è¿™äº›æ–­è¨€å‡½æ•°è¿›è¡Œå»ºæ¨¡ã€‚
ç¡®ä¿åœ¨åŒ…å«èŒƒå›´çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæ— è®ºæ£€æŸ¥ä»€ä¹ˆæ¡ä»¶éƒ½å¿…é¡»ä¸ºçœŸã€‚</p><pre><code class="language-typescript">function assert(condition: any, msg?: string): asserts condition {
  if (!condition) {
    throw new TypeError(msg);
  }
}
</code></pre><pre><code class="language-typescript">function yell(str) {
  assert(typeof str === &quot;string&quot;);

  return str.toUppercase();
  //         ~~~~~~~~~~~
  // error: Property &#x27;toUppercase&#x27; does not exist on type &#x27;string&#x27;.
  //        Did you mean &#x27;toUpperCase&#x27;?
}

function assert(condition: any, msg?: string): asserts condition {
  if (!condition) {
    throw new TypeError(msg);
  }
}
</code></pre><p>æ–­è¨€ç­¾åçš„å¦ä¸€ç§ç±»å‹ä¸æ£€æŸ¥æ¡ä»¶ï¼Œè€Œæ˜¯å‘Šè¯‰ TypeScript ç‰¹å®šçš„å˜é‡æˆ–å±æ€§å…·æœ‰ä¸åŒçš„ç±»å‹ã€‚å…¶ä½™èŒƒå›´å†… val ä¸€å®šæ˜¯ stringï¼Œç±»ä¼¼äºç±»å‹å®ˆå«</p><pre><code class="language-typescript">function assertIsString(val: any): asserts val is string {
  if (typeof val !== &quot;string&quot;) {
    throw new TypeError(&quot;Not a string!&quot;);
  }
}
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 3.8 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-3.8</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-3.8"/>
        <updated>2021-12-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ç±»å‹é™åˆ¶çš„å¯¼å…¥å¯¼å‡ºæ–¹æ³• (Type-Only Imports and Export)]]></summary>
        <content type="html"><![CDATA[<h2>ç±»å‹é™åˆ¶çš„å¯¼å…¥å¯¼å‡ºæ–¹æ³• (Type-Only Imports and Export)</h2><p>TypeScript 3.8 ä¸ºä»…ç±»å‹å¯¼å…¥å’Œå¯¼å‡ºæ·»åŠ äº†æ–°è¯­æ³•ã€‚æ­¤æ—¶å¯¼å…¥ã€å¯¼å‡ºçš„å˜é‡åªèƒ½ä½œä¸ºç±»å‹ä½¿ç”¨</p><pre><code class="language-typescript">import type { SomeThing } from &quot;./some-module.js&quot;;

export type { SomeThing };
</code></pre><pre><code class="language-typescript">import type { Component } from &quot;react&quot;;

interface ButtonProps {
    // ...
}

class Button extends Component&lt;ButtonProps&gt; {
    //               ~~~~~~~~~
    // error! &#x27;Component&#x27; only refers to a type, but is being used as a value here.

    // ...
}
</code></pre><h2>ECMAScript ææ¡ˆçš„ç§æœ‰å­—æ®µï¼ˆECMAScript Private Fieldsï¼‰</h2><h3>Private Fields çš„åŸºæœ¬ç‰¹æ€§</h3><ul><li><p>js ä¸­å·²ç»æœ‰ææ¡ˆï¼Œä½†æ˜¯æµè§ˆå™¨ä¸­è¿˜ä¸æ”¯æŒ</p></li><li><p>typescript ä¸­å·²ç»å¯ä»¥ä½¿ç”¨<code>#</code>æ¥å®šä¹‰çœŸæ­£çš„ç§æœ‰å±æ€§äº†</p></li></ul><pre><code class="language-typescript">class Person {
    #name: string

    constructor(name: string) {
        this.#name = name;
    }

    greet() {
        console.log(`Hello, my name is ${this.#name}!`);
    }
}

let jeremy = new Person(&quot;Jeremy Bearimy&quot;);

jeremy.#name
//     ~~~~~
// Property &#x27;#name&#x27; is not accessible outside class &#x27;Person&#x27;
// because it has a private identifier.
</code></pre><p>âš ï¸ å’Œå¸¸è§„å±æ€§(è¿™é‡Œç‰¹åˆ«æ¯”è¾ƒ private ä¿®é¥°ç¬¦å£°æ˜çš„æ¯”è¾ƒ)ä¸åŒï¼Œç§æœ‰å­—æ®µ(private fields)æ‹¥æœ‰ä¸‹é¢è¿™äº›ç‰¹æ€§ã€‚</p><ul><li>ä¸“ç”¨å­—æ®µä»¥ # å­—ç¬¦å¼€å¤´ã€‚æœ‰æ—¶æˆ‘ä»¬ç§°è¿™äº› prviate nameã€‚</li><li>æ¯ä¸ªä¸“ç”¨å­—æ®µåç§°éƒ½å”¯ä¸€åœ°é™å®šäºå…¶åŒ…å«çš„ç±»ã€‚</li><li>TypeScript è¾…åŠ©åŠŸèƒ½ä¿®é¥°ç¬¦ï¼Œä¾‹å¦‚ publicï¼Œprivate ä¸èƒ½åœ¨ç§æœ‰å­—æ®µä¸Šä½¿ç”¨ã€‚</li></ul><h3>Private Fields çš„ä½¿ç”¨è§„èŒƒ</h3><p>é™¤äº†èƒ½ä¿å­˜è‡ªå·±çš„ç§æœ‰è¿™ä¸€å±æ€§ä»¥å¤–ï¼Œç§æœ‰å­—æ®µçš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯æˆ‘ä»¬åˆšæ‰æåˆ°çš„å”¯ä¸€æ€§ã€‚ä¾‹å¦‚ï¼Œå¸¸è§„å±æ€§å£°æ˜æ˜“äºåœ¨å­ç±»ä¸­è¢«è¦†ç›–ã€‚è€Œ <code>private fields</code> æ˜¯å—ä¿æŠ¤çš„ã€‚</p><pre><code class="language-typescript">class C {
  foo = 10;

  cHelper() {
    return this.foo;
  }
}

class D extends C {
  foo = 20;

  dHelper() {
    return this.foo;
  }
}

let instance = new D();
// &#x27;this.foo&#x27; refers to the same property on each instance.
console.log(instance.cHelper()); // prints &#x27;20&#x27;
console.log(instance.dHelper()); // prints &#x27;20&#x27;
</code></pre><h3>é‚£æˆ‘ä»¬åˆ°åº•è¯¥ä½¿ç”¨ # å®šåˆ¶çš„ç§æœ‰å­—æ®µè¿˜æ˜¯ä½¿ç”¨ private ä¿®é¥°ç¬¦?</h3><p>å½“æ¶‰åŠåˆ°å±æ€§æ—¶ï¼ŒTypeScript çš„<code>private</code>ä¿®é¥°ç¬¦ä¼šå¹¶æ²¡æœ‰å®Œå…¨æ­£ç¡®çš„æ‰§è¡Œï¼Œå®ƒçš„è¡Œä¸ºå®Œå…¨åƒæ™®é€šå±æ€§ä¸€æ ·ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <code>soft privacy</code>, æˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡ <code>[&#x27;foo&#x27;]</code> è¿™æ ·çš„å½¢å¼è®¿é—®åˆ°ã€‚çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class="language-typescript">class C {
  private foo = 10;
}

// This is an error at compile time,
// but when TypeScript outputs .js files,
// it&#x27;ll run fine and print &#x27;10&#x27;.
console.log(new C().foo); // prints &#x27;10&#x27;
//                  ~~~
// error! Property &#x27;foo&#x27; is private and only accessible within class &#x27;C&#x27;.

// TypeScript allows this at compile-time
// as a &quot;work-around&quot; to avoid the error.
console.log(new C()[&quot;foo&quot;]); // prints &#x27;10&#x27;
</code></pre><p>å¯¹æ¯”ä¸‹é¢ä½¿ç”¨ <code>#</code> ç§æœ‰å­—æ®µï¼Œæ˜¯å®Œå…¨è®¿é—®ä¸åˆ°çš„</p><pre><code class="language-typescript">class C {
    #foo = 10;
}

console.log(new C().#foo); // SyntaxError
//                  ~~~~
// TypeScript reports an error *and*
// this won&#x27;t work at runtime!

console.log(new C()[&quot;#foo&quot;]); // prints undefined
//          ~~~~~~~~~~~~~~~
// TypeScript reports an error under &#x27;noImplicitAny&#x27;,
// and this prints &#x27;undefined&#x27;.
</code></pre><p><strong>ç»“è®ºå°±æ˜¯ï¼Œå¦‚æœä½ æƒ³ä¸¥æ ¼çš„ä¿æŠ¤æ‚¨çš„ç§æœ‰å±æ€§çš„å€¼ï¼Œå°±ä½¿ç”¨ <code>#</code> å³å¯ï¼Œå­ç±»ç»§æ‰¿çš„æ—¶å€™ä¹Ÿæ— éœ€æ‹…å¿ƒå‘½åå†²çªçš„é—®é¢˜ã€‚å½“æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ <code>private</code> çš„æ—¶å€™å°±éœ€è¦æ³¨æ„å¯¹ç§æœ‰ä¿®é¥°ç¬¦çš„å®šä¹‰çš„å€¼ä¿®æ”¹çš„é—®é¢˜äº†.</strong></p><h2>export <!-- -->*<!-- --> as xxx è¯­æ³•ä½¿ç”¨</h2><p>typescript ä¹Ÿæ”¯æŒè¿™ç§ç”¨æ³•å•¦ï¼Œåœ¨å¯¼å…¥æ¨¡å—çš„ as é‡æ–°å®šä¹‰æ¨¡å—åçš„æ¨¡å—çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°å¯¼å‡ºåˆ°å•ç‹¬æ¨¡å—åã€‚</p><p>menu.ts</p><pre><code class="language-typescript">export const MENU1 = &quot;nav: èœå• 1&quot;;
export const MENU2 = &quot;nav: èœå• 2&quot;;
export const MENU3 = &quot;nav: èœå• 3&quot;;
export const MENU4 = &quot;nav: èœå• 4&quot;;
export const DEMO = &quot;nav:Demo&quot;;
</code></pre><p>index.ts</p><pre><code class="language-typescript">import * as menu from &quot;./menu.ts&quot;;
console.log(menu.MENU1); // &#x27;nav: èœå• 1&#x27;ï¼›
console.log(menu.MENU2); // &#x27;nav: èœå• 2&#x27;ï¼›
// ....

export { menu };
</code></pre><h3><code>import * as React from &#x27;react&#x27;; vs import React from &#x27;react&#x27;;</code> è¿™ä¸¤ä¸ªä½¿ç”¨æœ‰ä»€ä¹ˆåŒºåˆ«?</h3><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ <code>import React from &#x27;react&#x27;</code> å…¶å®æ˜¯å¯¼å‡ºçš„é»˜è®¤çš„æ¨¡å—ï¼Œè€Œç”¨åˆ° <code>* as</code> æ˜¯å¯¼å‡ºå…¨éƒ¨æ¨¡å—ã€‚</p><h2>é¡¶å±‚ await ä½¿ç”¨</h2><p>js ä¹Ÿæ”¯æŒå•¦ ğŸ˜„</p><pre><code class="language-typescript">const response = await fetch(&quot;...&quot;);
const greeting = await response.text();
console.log(greeting);

// Make sure we&#x27;re a module
export {};
</code></pre><blockquote><p>æ³¨æ„ï¼šé¡¶å±‚ await åªä¼šåœ¨æ¨¡å—ä¸­èµ·ä½œç”¨ï¼Œåœ¨éæ¨¡å—æ–‡ä»¶ä¸­ä½¿ç”¨ä¼šæŠ¥é”™ã€‚é¡¶å±‚ await ä»…åœ¨æ¨¡å—çš„é¡¶å±‚èµ·ä½œç”¨ï¼Œå¹¶ä¸”åªæœ‰å½“ TypeScript æ‰¾åˆ°ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„æ¨¡å—æ‰å…è®¸ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª export {} æ¥æ£€æµ‹æ˜¯å¦åœ¨æ¨¡å—ä¸‹ä½¿ç”¨ã€‚</p></blockquote><pre><code class="language-typescript">const response = await fetch(&quot;...&quot;);
const greeting = await response.text();
console.log(greeting);

// &#x27;await&#x27; expressions are only allowed at the top level of a file when that file is a module, but this file has no imports or exports. Consider adding an empty &#x27;export {}&#x27; to make this file a module.
</code></pre>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typescript 3.9 å¸¸ç”¨æ–°ç‰¹æ€§]]></title>
        <id>typescript-3.9</id>
        <link href="https://guoxiaxing.github.io/Blog/typescript/typescript-3.9"/>
        <updated>2021-12-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[å†™åœ¨å‰é¢]]></summary>
        <content type="html"><![CDATA[<h2>å†™åœ¨å‰é¢</h2><p>æŒ‘é‡ç‚¹çš„è®²ä¸€è®²</p><h2>åœ¨æ¡ä»¶è¯­å¥ä¸­æ£€æµ‹æœªè°ƒç”¨çš„å‡½æ•°</h2><ul><li>åœ¨ 3.7 çš„æ—¶å€™å¼•å…¥äº†æ£€æµ‹æœªè°ƒç”¨å‡½æ•°é”™è¯¯æç¤ºï¼Œ3.9 åšäº†éƒ¨åˆ†ä¼˜åŒ–</li></ul><pre><code class="language-typescript">function hasImportantPermissions(): boolean {
  // ...
}
// Oops!
if (hasImportantPermissions) {
  //  ~~~~~~~~~~~~~~~~~~~~~~~
  // This condition will always return true since the function is always defined.
  // Did you mean to call it instead?
  deleteAllTheImportantFiles();
}
</code></pre><p>ä½†æ˜¯ï¼Œæ­¤é”™è¯¯ä»…é€‚ç”¨äº if è¯­å¥ä¸­çš„æ¡ä»¶ã€‚ç°åœ¨ä¸‰å…ƒæ¡ä»¶ï¼ˆå³è¯­æ³•ï¼‰ç°åœ¨ä¹Ÿæ”¯æŒæ­¤åŠŸèƒ½ã€‚</p><pre><code class="language-typescript">declare function listFilesOfDirectory(dirPath: string): string[];
declare function isDirectory(): boolean;
function getAllFiles(startFileName: string) {
  const result: string[] = [];
  traverse(startFileName);
  return result;
  function traverse(currentPath: string) {
    return isDirectory
      ? //     ~~~~~~~~~~~
        // This condition will always return true
        // since the function is always defined.
        // Did you mean to call it instead?
        listFilesOfDirectory(currentPath).forEach(traverse)
      : result.push(currentPath);
  }
}
</code></pre><h2>è§£æå¯é€‰é“¾ä¸é null æ–­è¨€ä¸­çš„å·®å¼‚</h2><ul><li>TypeScript æœ€è¿‘å®ç°äº†å¯¹å¯é€‰é“¾æ“ä½œç¬¦çš„æ”¯æŒï¼Œä½†æ ¹æ®å¹¿å¤§ä½¿ç”¨è€…çš„åé¦ˆï¼Œé null æ–­è¨€æ“ä½œç¬¦ï¼ˆ!ï¼‰çš„å¯é€‰é“¾ï¼ˆ?.ï¼‰è¡Œä¸ºä¸ç¬¦åˆç›´è§‰ã€‚</li></ul><pre><code class="language-typescript">foo?.bar!.baz;
</code></pre><p>è¢«è§£é‡Šä¸ºç­‰æ•ˆäºä»¥ä¸‹ JavaScript ä»£ç ï¼š</p><pre><code class="language-javascript">(foo?.bar).baz;
</code></pre><blockquote><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæ‹¬å·ä¼šé˜»æ­¢å¯é€‰é“¾çš„â€œçŸ­è·¯â€è¡Œä¸ºï¼›å› æ­¤å¦‚æœæœªå®šä¹‰ foo ä¸º undefinedï¼Œåˆ™è®¿é—® baz ä¼šå¼•å‘è¿è¡Œæ—¶é”™è¯¯ã€‚</p></blockquote><p>æ¢å¥è¯è¯´ï¼Œå¤§å¤šæ•°äººè®¤ä¸ºä»¥ä¸ŠåŸå§‹ä»£ç ç‰‡æ®µåº”è¯¥è¢«è§£é‡Šä¸ºåœ¨ï¼š</p><pre><code class="language-typescript">foo?.bar.baz;
</code></pre><p>ä¸­ï¼Œå½“ foo ä¸º undefined æ—¶ï¼Œè®¡ç®—ç»“æœä¸º undefinedã€‚</p><p>è¿™æ˜¯ä¸€é¡¹é‡å¤§å˜åŒ–ï¼Œä½†æˆ‘ä»¬è®¤ä¸ºå¤§éƒ¨åˆ†ä»£ç åœ¨ç¼–å†™æ—¶éƒ½æ˜¯ä¸ºäº†è€ƒè™‘æ–°çš„è§£é‡Šåœºæ™¯ã€‚å¦‚æœæ‚¨å¸Œæœ›ç»§ç»­ä½¿ç”¨æ—§æœ‰è¡Œä¸ºï¼Œåˆ™å¯åœ¨!æ“ä½œç¬¦å·¦ä¾§æ·»åŠ æ‹¬å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>(foo?.bar)!.baz;
</code></pre>]]></content>
    </entry>
</feed>