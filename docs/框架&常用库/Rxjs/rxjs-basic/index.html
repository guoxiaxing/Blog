<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/Blog/blog/rss.xml" title="Try&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Blog/blog/atom.xml" title="Try&#39;s Blog Atom Feed"><title data-react-helmet="true">rxjs åŸºç¡€æ¦‚å¿µ | Try&#x27;s Blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://guoxiaxing.github.io/Blog/docs/æ¡†æ¶&amp;å¸¸ç”¨åº“/Rxjs/rxjs-basic"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="rxjs åŸºç¡€æ¦‚å¿µ | Try&#x27;s Blog"><meta data-react-helmet="true" name="description" content="Rxjs æ˜¯ä»€ä¹ˆï¼Ÿ"><meta data-react-helmet="true" property="og:description" content="Rxjs æ˜¯ä»€ä¹ˆï¼Ÿ"><link data-react-helmet="true" rel="shortcut icon" href="/Blog/img/logo.png"><link data-react-helmet="true" rel="canonical" href="https://guoxiaxing.github.io/Blog/docs/æ¡†æ¶&amp;å¸¸ç”¨åº“/Rxjs/rxjs-basic"><link data-react-helmet="true" rel="alternate" href="https://guoxiaxing.github.io/Blog/docs/æ¡†æ¶&amp;å¸¸ç”¨åº“/Rxjs/rxjs-basic" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://guoxiaxing.github.io/Blog/docs/æ¡†æ¶&amp;å¸¸ç”¨åº“/Rxjs/rxjs-basic" hreflang="x-default"><link rel="stylesheet" href="/Blog/assets/css/styles.c913d63a.css">
<link rel="preload" href="/Blog/assets/js/runtime~main.fa86c0dc.js" as="script">
<link rel="preload" href="/Blog/assets/js/main.f4361df4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Blog/"><div class="navbar__logo"><img src="/Blog/img/logo.png" alt="Try&#x27;s Blog" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/Blog/img/logo.png" alt="Try&#x27;s Blog" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Try&#x27;s Blog</b></a><a class="navbar__item navbar__link navbar__link--active" href="/Blog/docs/quick-link">æŠ€æœ¯</a><a class="navbar__item navbar__link" href="/Blog/blog">ç”Ÿæ´»</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/guoxiaxing/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Blog/docs/learn-list">å­¦ä¹ æ¸…å•</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Blog/docs/quick-link">ç›®å½•</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CSS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Javascript</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Linux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Typescript</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">å­¦ä¹ æå‡</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">æ¡†æ¶&amp;å¸¸ç”¨åº“</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Blog/docs/æ¡†æ¶&amp;å¸¸ç”¨åº“/react-angular-vue">ç»†è¯´vue react angular åŒºåˆ«</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Angular</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">React</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Rxjs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Blog/docs/æ¡†æ¶&amp;å¸¸ç”¨åº“/Rxjs/rxjs-operators">rxjs æ“ä½œç¬¦</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Blog/docs/æ¡†æ¶&amp;å¸¸ç”¨åº“/Rxjs/rxjs-basic">rxjs åŸºç¡€æ¦‚å¿µ</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ç½‘ç»œ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">å·¥å…·</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">å·¥ç¨‹åŒ–</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">è¯»ä¹¦ç¬”è®°</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>rxjs åŸºç¡€æ¦‚å¿µ</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="rxjs-æ˜¯ä»€ä¹ˆ">Rxjs æ˜¯ä»€ä¹ˆï¼Ÿ<a aria-hidden="true" class="hash-link" href="#rxjs-æ˜¯ä»€ä¹ˆ" title="Direct link to heading">â€‹</a></h2><p>RxJS æ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒé€šè¿‡ä½¿ç”¨ observable åºåˆ—æ¥ç¼–å†™å¼‚æ­¥å’ŒåŸºäºäº‹ä»¶çš„ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ ¸å¿ƒç±»å‹ Observableï¼Œé™„å±ç±»å‹ (Observerã€ Schedulersã€ Subjects) å’Œæ“ä½œç¬¦ (mapã€filterã€reduceã€every, ç­‰ç­‰)ï¼Œè¿™äº›æ•°ç»„æ“ä½œç¬¦å¯ä»¥æŠŠå¼‚æ­¥äº‹ä»¶ä½œä¸ºé›†åˆæ¥å¤„ç†ã€‚</p><blockquote><p>å¯ä»¥æŠŠ RxJS å½“åšæ˜¯ç”¨æ¥å¤„ç†äº‹ä»¶çš„ Lodashã€‚</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ç‰¹ç‚¹">ç‰¹ç‚¹<a aria-hidden="true" class="hash-link" href="#ç‰¹ç‚¹" title="Direct link to heading">â€‹</a></h2><ul><li>çº¯å‡€æ€§ï¼šä½¿ç”¨çº¯å‡½æ•°æ¥äº§ç”Ÿå€¼ï¼Œä¸éœ€è¦å€ŸåŠ©å¤–éƒ¨å˜é‡</li><li>æµåŠ¨æ€§ï¼šRxJS æä¾›äº†ä¸€æ•´å¥—æ“ä½œç¬¦æ¥å¸®åŠ©ä½ æ§åˆ¶äº‹ä»¶å¦‚ä½•æµç» observables ã€‚</li><li>å€¼ï¼šå¯ä»¥å¯¹æµç» observable çš„å€¼è¿›è¡Œè½¬æ¢</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="rxjs-observables-vs-promise">Rxjs Observables vs Promise<a aria-hidden="true" class="hash-link" href="#rxjs-observables-vs-promise" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å¤šå€¼-vs-å•å€¼">å¤šå€¼ vs å•å€¼<a aria-hidden="true" class="hash-link" href="#å¤šå€¼-vs-å•å€¼" title="Direct link to heading">â€‹</a></h3><p>ä¸€ä¸ª Promise åªèƒ½äº§ç”Ÿä¸€ä¸ªå€¼/é”™è¯¯ï¼Œä¹‹åçš„å€¼æˆ–è€…é”™è¯¯éƒ½ä¼šè¢«å¿½ç•¥ã€‚è¿™ä¹Ÿå°±æ˜¯ Promise çš„çŠ¶æ€åªèƒ½æ”¹å˜ä¸€æ¬¡ï¼Œä¸€æ—¦æ”¹å˜å°±ä¸ä¼šå†å˜ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> numberPromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸ç”Ÿæ•ˆ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">numberPromise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è¾“å‡º åªä¼šæœ‰ 5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å†çœ‹çœ‹ Observable</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rxjs/Observable&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Observable</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> numberObservable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">observer</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">numberObservable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è¾“å‡º 5 10</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Observable æ˜¯å¯ä»¥äº§ç”Ÿå¤šä¸ªå€¼çš„ï¼Œè¿™ä¸€ç‚¹å’Œ promise çš„å·®åˆ«å¾ˆå¤§ã€‚å¹³å¸¸æˆ‘ä»¬å¯èƒ½é‡åˆ°çš„å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯ä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªå“åº”ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿä¼šæœ‰äº§ç”Ÿå¤šä¸ªå€¼çš„æƒ…å†µï¼š</p><ul><li>å®šæ—¶å™¨</li><li>DOM äº‹ä»¶</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä»£ç æ‰§è¡Œ">ä»£ç æ‰§è¡Œ<a aria-hidden="true" class="hash-link" href="#ä»£ç æ‰§è¡Œ" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Promiseæ„é€ å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯åŒæ­¥æ‰§è¡Œçš„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> promise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;promise call&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;promise end&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ‰§è¡Œè¿™æ®µä»£ç  promise call å’Œ promise end ä¼šç«‹å³æ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;I was called!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ­¤æ—¶å¹¶æ²¡æœ‰console</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åªæœ‰ observable.subscribe(); è¿™ä¸ªæ—¶å€™ I was calledï¼æ‰ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç° observable æ˜¯ lazy çš„ï¼Œåªæœ‰åœ¨è®¢é˜…çš„æ—¶å€™ä»£ç æ‰ä¼šè¢«æ‰§è¡Œ</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="-èƒ½å–æ¶ˆ-vs-ä¸èƒ½å–æ¶ˆ"> èƒ½å–æ¶ˆ vs ä¸èƒ½å–æ¶ˆ<a aria-hidden="true" class="hash-link" href="#-èƒ½å–æ¶ˆ-vs-ä¸èƒ½å–æ¶ˆ" title="Direct link to heading">â€‹</a></h3><p>promise é»˜è®¤æ˜¯ä¸èƒ½å–æ¶ˆçš„ï¼Œä¸€æ—¦åˆ›å»ºå°±ä¼šè¢«æ‰§è¡Œã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rxjs/Observable&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Observable</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">observer</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">clearInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> subscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subscription</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç»“æœ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 0!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 1!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 2!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 3!</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>observable æ˜¯å¯ä»¥è¢«å–æ¶ˆçš„ï¼Œå¯ä»¥ä½¿ç”¨ subscribe è¿”å›çš„å€¼ï¼Œä¸€ä¸ª Subscription å¯¹è±¡çš„ unsubscribe æ–¹æ³•æ¥å–æ¶ˆè®¢é˜…ã€‚</p><p><strong>new Observable ä¼ å…¥çš„å‡½æ•°çš„è¿”å›å€¼ä¼šåœ¨ unsubscribe è°ƒç”¨çš„æ—¶å€™è¢«æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬å–æ¶ˆçš„æ˜¯å¯¹è¿™ä¸ª observable çš„è®¢é˜…ï¼Œä½†æ˜¯åŸæ¥çš„ new Observable ä¸­çš„å®šæ—¶å™¨ä¾æ—§åœ¨æ‰§è¡Œï¼Œåªæ˜¯è¯¥å®šæ—¶å™¨å‘çš„å€¼ï¼Œæ²¡æœ‰è¢«è®¢é˜…è€Œå·²ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰§è¡Œ<code>() =&gt; clearInterval(token)</code>æ¸…é™¤è¯¥å®šæ—¶å™¨</strong></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å¤šä¸ªè®¢é˜…-vs-å•ä¸ªè®¢é˜…">å¤šä¸ªè®¢é˜… vs å•ä¸ªè®¢é˜…<a aria-hidden="true" class="hash-link" href="#å¤šä¸ªè®¢é˜…-vs-å•ä¸ªè®¢é˜…" title="Direct link to heading">â€‹</a></h3><p>ä¸€ä¸ª promise è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œä»–å°±å·²ç»æ‰§è¡Œäº†ï¼Œå¹¶ä¸”ä¸èƒ½é‡å¤çš„è¢«æ‰§è¡Œäº†ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> waitOneSecondPromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;promise call&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hello world&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">waitOneSecondPromise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ç¬¬ä¸€æ¬¡&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  waitOneSecondPromise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ç¬¬äºŒæ¬¡&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è¾“å‡ºç»“æœæ˜¯ promise call</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç¬¬ä¸€æ¬¡ hello world 1007</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç¬¬äºŒæ¬¡ hello world 5006</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç¬¬ä¸€ä¸ª then ä¼šåœ¨ 1s åè¾“å‡ºå€¼ï¼Œç¬¬äºŒä¸ª then ä¼šåœ¨ 5s åç«‹å³è¾“å‡ºå€¼ï¼Œå› ä¸ºç¬¬äºŒä¸ª then æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ promise çš„çŠ¶æ€å·²ç»æ”¹å˜ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç›´æ¥æ‹¿åˆ° promise resolve çš„å€¼ï¼Œä¸éœ€è¦å†ç­‰å¾… 1s äº†</p><p>observableï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rxjs/Observable&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Observable</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> waitOneSecondObservable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">observer</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;I was called&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hey girl&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">waitOneSecondObservable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ç¬¬ä¸€æ¬¡&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  waitOneSecondObservable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ç¬¬äºŒæ¬¡&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è¾“å‡º</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// I was called</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç¬¬ä¸€æ¬¡ hey girl 1003</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// I was called</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç¬¬äºŒæ¬¡ hey girl 1003</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¯¹äº observableï¼Œè¿™é‡Œå…¶å®æ˜¯(Cold Observable)ä»–ä»¬æ¯æ¬¡è¢« subscribe éƒ½æ˜¯ä¸€æ¬¡æ–°çš„è®¢é˜…ï¼Œobservable ä¼šè¢«é‡æ–°æ‰§è¡Œã€‚æ‰€ä»¥æ— è®º observable ä½•æ—¶è¢« subscribe äº§ç”Ÿçš„å€¼éƒ½æ˜¯ä¸€æ ·çš„</p><p>ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›æ¯æ¬¡ subscribe éƒ½é‡æ–°è®¢é˜…ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒå¯ä»¥å…±äº«å‰é¢çš„è®¢é˜…ï¼Œä¹Ÿå°±æ˜¯ä¸å¸Œæœ›è¿™ä¸ª observable è¢«é‡æ–°åœ¨æ‰§è¡Œä¸€éï¼Œå¤šç”¨äº http è¯·æ±‚çš„åœºæ™¯ã€‚åœ¨ http è¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åªå‘ä¸€æ¬¡è¯·æ±‚ï¼Œä½†æ˜¯ç»“æœè¢«å¤šä¸ªè®¢é˜…è€…å…±ç”¨ã€‚ Observable æœ¬èº«æ²¡æœ‰æä¾›è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ RxJS è¿™ä¸ªåº“æ¥å®ç°ï¼Œå®ƒæœ‰ä¸€ä¸ª share çš„ operatorã€‚å…¶å®è¿™å°±æ˜¯å°†ä¸€ä¸ª Cold Observable å˜ä¸ºäº† Hot Observableã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> waitOneSecondObservable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">observer</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å‘é€httpè¯·æ±‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sharedWaitOneSecondObservable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> waitOneSecondObservable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">share</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sharedWaitOneSecondObservable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">doSomething</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sharedWaitOneSecondObservable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">doSomethingElse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ä½¿ç”¨äº†shareï¼Œè™½ç„¶subscribeäº†å¤šæ¬¡ï¼Œä½†æ˜¯ä»…å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œshareäº†ç»“æœã€‚</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="å¯èƒ½æ˜¯å¼‚æ­¥-vs-ä¸€ç›´æ˜¯å¼‚æ­¥">å¯èƒ½æ˜¯å¼‚æ­¥ vs ä¸€ç›´æ˜¯å¼‚æ­¥<a aria-hidden="true" class="hash-link" href="#å¯èƒ½æ˜¯å¼‚æ­¥-vs-ä¸€ç›´æ˜¯å¼‚æ­¥" title="Direct link to heading">â€‹</a></h3><p>promise ä¸­åŒæ­¥çš„ resolve äº†ä¸€ä¸ªå€¼ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯ä¼šå¼‚æ­¥æ‰§è¡Œã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> promise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;And now we are here.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// And now we are here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 5!</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>promise ä¸€ç›´æ˜¯å¼‚æ­¥ï¼Œ Observables åˆ™æ¯”è¾ƒçµæ´»ï¼Œæ˜¯å¦ä¸ºå¼‚æ­¥å¾—æ ¹æ®è‡ªå·±çš„å‡½æ•°æ¥å®šï¼Œè¿™ç‚¹ä¹Ÿæ¯”è¾ƒå±é™©ã€‚rxjs ä¸­æœ‰ä¸€äº›æ“ä½œç¬¦å¯ä»¥è®©ç›‘å¬å¼ºåˆ¶ä¸ºå¼‚æ­¥çš„æ–¹å¼ï¼Œä¾‹å¦‚ observeOnã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rxjs/Observable&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Observable</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> observable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">observer</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    observer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;And now we are here.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 5!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// And now we are here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 6!</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="observable">Observable<a aria-hidden="true" class="hash-link" href="#observable" title="Direct link to heading">â€‹</a></h2><p>å¯è§‚å¯Ÿå¯¹è±¡</p><ul><li><strong>å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒæ­¥çš„</strong></li><li>æ˜¯ä¸€ä¸ªæ˜¯å¤šä¸ªå€¼çš„æƒ°æ€§æ¨é€é›†åˆã€‚å¯ä»¥äº§ç”Ÿå€¼ã€‚</li><li>Observable å¯ä»¥éšç€æ—¶é—´çš„æ¨ç§» â€œè¿”å›â€ å¤šä¸ªå€¼</li><li>åœ¨ Observable æ‰§è¡Œä¸­, å¯èƒ½ä¼šå‘é€é›¶ä¸ªåˆ°æ— ç©·å¤šä¸ª &quot;Next&quot; é€šçŸ¥ã€‚å¦‚æœå‘é€çš„æ˜¯ &quot;Error&quot; æˆ– &quot;Complete&quot; é€šçŸ¥çš„è¯ï¼Œé‚£ä¹ˆä¹‹åä¸ä¼šå†å‘é€ä»»ä½•é€šçŸ¥äº†ã€‚</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cold-observable">Cold Observable<a aria-hidden="true" class="hash-link" href="#cold-observable" title="Direct link to heading">â€‹</a></h3><p>å•æ’­çš„ observable
<strong>åªæœ‰è¢« Observer è®¢é˜…äº†æ‰ä¼šå¼€å§‹äº§ç”Ÿå€¼ã€‚</strong>æœ‰å¤šå°‘ä¸ªè®¢é˜…å°±ä¼šç”Ÿæˆå¤šå°‘ä¸ªè®¢é˜…çš„å®ä¾‹ï¼Œæ¯ä¸ªè®¢é˜…éƒ½æ˜¯ä»ç¬¬ä¸€ä¸ªäº§ç”Ÿçš„å€¼å¼€å§‹æ¥æ”¶å€¼ï¼Œæ‰€ä»¥æ¯ä¸ªè®¢é˜…æ¥æ”¶åˆ°çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚
æ¯ä¸ªæ™®é€šçš„ Observables å®ä¾‹éƒ½åªèƒ½è¢«ä¸€ä¸ªè§‚å¯Ÿè€…è®¢é˜…ï¼Œå½“å®ƒè¢«å…¶ä»–è§‚å¯Ÿè€…è®¢é˜…çš„æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯æ™®é€š Observables è¢«ä¸åŒçš„è§‚å¯Ÿè€…è®¢é˜…çš„æ—¶å€™ï¼Œä¼šæœ‰å¤šä¸ªå®ä¾‹ï¼Œä¸ç®¡è§‚å¯Ÿè€…æ˜¯ä»ä½•æ—¶å¼€å§‹è®¢é˜…ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æ˜¯ä»å¤´å¼€å§‹æŠŠå€¼å‘ç»™å¯¹åº”çš„è§‚å¯Ÿè€…ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="hot-observable">Hot Observable<a aria-hidden="true" class="hash-link" href="#hot-observable" title="Direct link to heading">â€‹</a></h3><p>ä¸ç®¡æœ‰æ²¡æœ‰è®¢é˜…éƒ½ä¼šäº§ç”Ÿå€¼ã€‚æ˜¯å¤šæ’­çš„ï¼Œå¤šä¸ªè®¢é˜…ä¼šå…±äº«åŒä¸€ä¸ªå®ä¾‹ã€‚æ˜¯ä»è®¢é˜…å¼€å§‹æ¥æ”¶å€¼ï¼Œæ¯ä¸ªè®¢é˜…æ¥æ”¶åˆ°çš„å€¼éƒ½æ˜¯ä¸åŒçš„ï¼Œå–å†³äºä»–ä»¬ä»€ä¹ˆæ—¶å€™è®¢é˜…ã€‚</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="æ€ä¹ˆåˆ›å»º-hot-observable">æ€ä¹ˆåˆ›å»º Hot Observable<a aria-hidden="true" class="hash-link" href="#æ€ä¹ˆåˆ›å»º-hot-observable" title="Direct link to heading">â€‹</a></h4><h5 class="anchor anchorWithStickyNavbar_y2LR" id="multicast--subject">multicast + Subject<a aria-hidden="true" class="hash-link" href="#multicast--subject" title="Direct link to heading">â€‹</a></h5><p>multicast æ“ä½œç¬¦çš„å·¥ä½œåŸç†ï¼šè§‚å¯Ÿè€…è®¢é˜…ä¸€ä¸ªåŸºç¡€çš„ Subjectï¼Œç„¶å Subject è®¢é˜…æº Observable ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Rx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> subject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Rx</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> multicasted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">multicast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨åº•å±‚ä½¿ç”¨äº† `subject.subscribe({...})`:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">v</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;observerA: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">v</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;observerB: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨åº•å±‚ä½¿ç”¨äº† `source.subscribe(subject)`:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>multicast è¿”å›çš„æ˜¯ ConnectableObservableï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæœ‰ connect() æ–¹æ³•çš„ Observable ã€‚</p><p>connect() æ–¹æ³•ååˆ†é‡è¦ï¼Œå®ƒå†³å®šäº†ä½•æ—¶å¯åŠ¨å…±äº«çš„ Observable æ‰§è¡Œã€‚å› ä¸º connect() æ–¹æ³•åœ¨åº•å±‚æ‰§è¡Œäº† source.subscribe(subject)ï¼Œæ‰€ä»¥å®ƒè¿”å›çš„æ˜¯ Subscriptionï¼Œä½ å¯ä»¥å–æ¶ˆè®¢é˜…ä»¥å–æ¶ˆå…±äº«çš„ Observable æ‰§è¡Œã€‚</p><blockquote><p>ConnectableObservable: ConnectableObservable æ˜¯å¤šæ’­çš„å…±äº« Observableï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ª observers å…±äº«è®¢é˜…ï¼Œå®ƒæ˜¯ Hot Observablesã€‚ConnectableObservable æ˜¯è®¢é˜…è€…å’ŒçœŸæ­£çš„æºå¤´ Observables çš„ä¸­é—´äººï¼ŒConnectableObservable ä»æºå¤´ Observables æ¥æ”¶åˆ°å€¼ç„¶åå†æŠŠå€¼è½¬å‘ç»™è®¢é˜…è€…ã€‚</p></blockquote><h5 class="anchor anchorWithStickyNavbar_y2LR" id="refcount">refCount()<a aria-hidden="true" class="hash-link" href="#refcount" title="Direct link to heading">â€‹</a></h5><p>ConnectableObservable çš„ refCount() æ–¹æ³•(å¼•ç”¨è®¡æ•°)ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å› Observableï¼Œè¿™ä¸ª Observable ä¼šè¿½è¸ªæœ‰å¤šå°‘ä¸ªè®¢é˜…è€…ã€‚å½“è®¢é˜…è€…çš„æ•°é‡ä» 0 å˜æˆ 1ï¼Œå®ƒä¼šè°ƒç”¨ connect() ä»¥å¼€å¯å…±äº«çš„æ‰§è¡Œã€‚å½“è®¢é˜…è€…æ•°é‡ä» 1 å˜æˆ 0 æ—¶ï¼Œå®ƒä¼šå®Œå…¨å–æ¶ˆè®¢é˜…ï¼Œåœæ­¢è¿›ä¸€æ­¥çš„æ‰§è¡Œã€‚</p><p><strong>refCount çš„ä½œç”¨æ˜¯ï¼Œå½“æœ‰ç¬¬ä¸€ä¸ªè®¢é˜…è€…æ—¶ï¼Œå¤šæ’­ Observable ä¼šè‡ªåŠ¨åœ°å¯åŠ¨æ‰§è¡Œï¼Œè€Œå½“æœ€åä¸€ä¸ªè®¢é˜…è€…ç¦»å¼€æ—¶ï¼Œå¤šæ’­ Observable ä¼šè‡ªåŠ¨åœ°åœæ­¢æ‰§è¡Œã€‚</strong></p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="publish">publish()<a aria-hidden="true" class="hash-link" href="#publish" title="Direct link to heading">â€‹</a></h5><p>ç­‰ä»·äº multicast(new Subject())</p><p>è¿™ä¸ªæ“ä½œç¬¦å¯ä»¥å°† cold observable è½¬æ¢ä¸º ConnectableObservableï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬ä½¿ç”¨çš„åˆ›å»º Subject å®ä¾‹</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obs$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">interval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">publish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">refCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>publish(xxx).refCount()åœ¨æº observable å®Œæˆçš„æ—¶å€™å†å‡ºç°è®¢é˜…è€…æ—¶ï¼Œä¸ä¼šé‡æ–°è®¢é˜…æº observable</strong></p><p><strong>é‡æ–°è®¢é˜…å·²å®Œæˆçš„ observables</strong></p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ ¹æ®ç¤ºä¾‹æˆ‘ä»¬å¯ä»¥å‘ç° publish ä»¥åŠå®ƒçš„å˜ç§:</p><ul><li><p>å½“æº observable å®Œæˆæ—¶ï¼Œè´Ÿè´£å¤šæ’­åŸºç¡€ç»“æ„çš„ subject ä¹Ÿä¼šå®Œæˆï¼Œè€Œä¸”è¿™ä¼šé˜»æ­¢å¯¹æº observable çš„é‡æ–°è®¢é˜…ã€‚</p></li><li><p>å½“ publish å’Œ publishBehavior ä¸ refCount ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œåæ¥çš„è®¢é˜…è€…åªä¼šæ”¶åˆ° complete é€šçŸ¥ï¼Œè¿™ä¼¼ä¹å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚</p></li><li><p>å½“ publishReplay å’Œ publishLast ä¸ refCount ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œåæ¥çš„è®¢é˜…è€…ä¼šæ”¶åˆ°é¢„æœŸçš„é€šçŸ¥ã€‚</p></li></ul><p><strong>é‡æ–°è®¢é˜…æœªå®Œæˆçš„ observable</strong></p><p>å½“å¯¹æœªå®Œæˆçš„æº observable ä½¿ç”¨ refCount æ—¶ï¼Œpublishã€publishBehavior å’Œ publishReplay çš„è¡Œä¸ºéƒ½å¦‚é¢„æœŸä¸€èˆ¬ï¼ˆå½“è®¢é˜…è€…çš„æ•°é‡ä» 0 å˜æˆ 1ï¼Œå®ƒä¼šè°ƒç”¨ connect() ä»¥å¼€å¯å…±äº«çš„æ‰§è¡Œã€‚å½“è®¢é˜…è€…æ•°é‡ä» 1 å˜æˆ 0 æ—¶ï¼Œå®ƒä¼šå®Œå…¨å–æ¶ˆè®¢é˜…ï¼Œåœæ­¢è¿›ä¸€æ­¥çš„æ‰§è¡Œï¼‰ï¼Œä¼šé‡æ–°è®¢é˜…æº observable</p><ul><li>publishReplay vs publishBehavior</li></ul><p><strong>å·²å®Œæˆçš„ ReplaySubject å°†é€šçŸ¥é‡æ”¾ç»™åæ¥çš„è®¢é˜…è€…ï¼Œæ‰€ä»¥ b èƒ½æ”¶åˆ°é‡æ”¾çš„ next é€šçŸ¥å’Œ complete é€šçŸ¥ã€‚ä½†æ˜¯ publishBehavior åœ¨æº observable complete ä¹‹åï¼Œåé¢è®¢é˜…çš„ observer å°†ä¸ä¼šå†æ”¶åˆ°æœ€æ–°å€¼</strong></p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="share">share()<a aria-hidden="true" class="hash-link" href="#share" title="Direct link to heading">â€‹</a></h5><p>ç­‰ä»·äº publish() + refCount()</p><p>ä½†æ˜¯ï¼Œshare ä¼ ç»™ multicast çš„æ˜¯å·¥å‚å‡½æ•°ï¼Œè¿™æ„å‘³ç€åœ¨å¼•ç”¨è®¡æ•°ä¸º 0 ä¹‹åå‘ç”Ÿè®¢é˜…çš„è¯ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Subject æ¥è®¢é˜…æº observable ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obs$ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">interval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">share</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>publishReplayã€shareReplayã€publishBehaviorã€publishLast éƒ½å¯ä»¥å°†å•æ’­çš„ Observable è½¬æ¢ä¸ºå¤šæ’­çš„ Observableï¼Œåªä¸è¿‡åº•å±‚ä½¿ç”¨äº†ä¸åŒç±»å‹çš„ Subject</p></blockquote><p>ä¸ share ç±»ä¼¼ï¼Œ shareReplay ä¼ ç»™ multicast æ“ä½œç¬¦çš„ä¹Ÿæ˜¯ subject çš„å·¥å‚å‡½æ•°ã€‚è¿™æ„å‘³ç€å½“é‡æ–°è®¢é˜…æº observable æ—¶ï¼Œä¼šä½¿ç”¨å·¥å‚å‡½æ•°æ¥åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„ subject ã€‚ä½†æ˜¯ï¼Œåªæœ‰<strong>å½“å‰ä¸€ä¸ªè¢«è®¢é˜… subject æœªå®Œæˆ</strong>çš„æƒ…å†µä¸‹ï¼Œå·¥å‚å‡½æ•°æ‰ä¼šè¿”å›æ–°çš„ subject ã€‚</p><p>publishReplay ä¼ ç»™ multicast æ“ä½œç¬¦çš„æ˜¯ ReplaySubject å®ä¾‹ï¼Œè€Œä¸æ˜¯å·¥å‚å‡½æ•°ï¼Œè¿™æ˜¯å½±å“è¡Œä¸ºä¸åŒçš„åŸå› ã€‚</p><p>å¯¹è°ƒç”¨äº† publishReplay().refCount() çš„ observable è¿›è¡Œé‡æ–°è®¢é˜…ï¼Œsubject ä¼šä¸€ç›´é‡æ”¾å®ƒçš„å¯é‡æ”¾é€šçŸ¥ã€‚ä½†æ˜¯ï¼Œå¯¹è°ƒç”¨äº† shareReplay() çš„ observable è¿›è¡Œé‡æ–°è®¢é˜…ï¼Œè¡Œä¸ºæœªå¿…å¦‚å‰è€…ä¸€æ ·ï¼Œå¦‚æœ subject è¿˜æœªå®Œæˆï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ subject ã€‚(å¦‚æœ subject å·²å®Œæˆï¼Œåˆ™å’Œ publishReplay().refCount()çš„æ•ˆæœç›¸åŒï¼Œä¸ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ subject)æ‰€ä»¥åŒºåˆ«åœ¨äºï¼Œä½¿ç”¨è°ƒç”¨äº† shareReplay() çš„ observable çš„è¯ï¼Œå½“å¼•ç”¨è®¡æ•°å½’é›¶æ—¶ï¼Œå¦‚æœ subject è¿˜æœªå®Œæˆçš„è¯ï¼Œå¯é‡æ”¾çš„é€šçŸ¥ä¼šè¢«å†²æ´—æ‰ã€‚</p><p><strong>publishReplay().refCount() vs shareReplay() å¯¹äºå½“å‰ subject å®Œæˆçš„æƒ…å†µ</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> instrument</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">observer</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> Observer</span><span class="token parameter operator" style="color:#393A34">&lt;</span><span class="token parameter">T</span><span class="token parameter operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;source: subscribing&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> subscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">tap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">source: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">value</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">observer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          subscription</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;source: unsubscribed&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> observer</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">observer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">value</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">complete</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">observer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">: complete</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">timer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> counted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">shareReplay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">110</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¾“å‡º</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">source: subscribing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer a: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer a: complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: unsubscribed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: complete</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>publishReplay().refCount() vs shareReplay() è®¢é˜…æœªå®Œæˆçš„ observable æƒ…å†µ</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">interval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> counted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">publishReplay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">refCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¾“å‡º</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">source: subscribing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer a: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: unsubscribed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: subscribing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">interval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> counted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">shareReplay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¾“å‡º</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">source: subscribing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer a: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>å¯¹äº shareReplay çš„è¯ï¼Œå¹¶ä¸ä¼šåœ¨è®¢é˜…è€…ä¸º 0 çš„æ—¶å€™å–æ¶ˆå¯¹æº observable çš„è®¢é˜…å¹¶ä¸”é‡æ–°è®¢é˜…</strong>
<strong>shareReplay åªä¼šåœ¨æº observable complete æˆ– error æ—¶æ‰ä¼šå–æ¶ˆè®¢é˜…ï¼Œå½“å¼•ç”¨è®¡æ•°å½’é›¶æ—¶ï¼Œæ“ä½œç¬¦ä¸å†å–æ¶ˆæº observable çš„è®¢é˜…ã€‚</strong></p><ul><li>å¦‚æœæº observable æŠ¥é”™ï¼ŒpublishReplay().refCount() è¿”å›çš„ observable çš„ä»»ä½•åæ¥è®¢é˜…è€…éƒ½å°†æ”¶åˆ°é”™è¯¯ã€‚</li><li>ä½†æ˜¯ï¼ŒshareReplay è¿”å›çš„ observable çš„ä»»ä½•åæ¥è®¢é˜…è€…éƒ½å°†äº§ç”Ÿä¸€ä¸ªæº observable çš„æ–°è®¢é˜…ã€‚</li></ul><p><strong>ä½†æ˜¯å¯¹äº share æ¥è¯´ï¼Œåˆ™æ€»ä¼šåœ¨é‡æ–°è®¢é˜…çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªæ–°çš„ subjectï¼Œå¹¶ä¸”é‡æ–°è®¢é˜…æº observableï¼Œä¸è®ºå½“å‰çš„ subject æ˜¯å¦å®Œæˆ</strong></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> instrument</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">observer</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> Observer</span><span class="token parameter operator" style="color:#393A34">&lt;</span><span class="token parameter">T</span><span class="token parameter operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;source: subscribing&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> subscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">tap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">source: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">value</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">observer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          subscription</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;source: unsubscribed&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">as</span><span class="token plain"> </span><span class="token maybe-class-name">Observable</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> observer</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">observer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">value</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function-variable function" style="color:#d73a49">complete</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">observer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">: complete</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">timer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> counted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">share</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">110</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¾“å‡º</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">source: subscribing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer a: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: unsubscribed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer a: complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: subscribing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: unsubscribed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: complete</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">instrument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">interval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> counted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">share</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> counted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">observer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¾“å‡º</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">source: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer a: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: unsubscribed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: subscribing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observer b: 2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="observer">Observer<a aria-hidden="true" class="hash-link" href="#observer" title="Direct link to heading">â€‹</a></h2><p>è§‚å¯Ÿè€…</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…">ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…ï¼Ÿ<a aria-hidden="true" class="hash-link" href="#ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…" title="Direct link to heading">â€‹</a></h3><p>å®šä¹‰å¯¹äº observable è¯¥å¦‚ä½•å¤„ç†</p><p>è§‚å¯Ÿè€…æ˜¯ Observable å‘é€çš„å€¼çš„æ¶ˆè´¹è€…ã€‚è§‚å¯Ÿè€…åªæ˜¯ä¸€ç»„å›è°ƒå‡½æ•°çš„é›†åˆï¼Œæ¯ä¸ªå›è°ƒå‡½æ•°å¯¹åº”ä¸€ç§ Observable å‘é€çš„é€šçŸ¥ç±»å‹ï¼šnextã€error å’Œ complete ã€‚</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> observer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Observer got a next value: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">error</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Observer got an error: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">complete</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Observer got a complete notification&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>è¦ä½¿ç”¨è§‚å¯Ÿè€…ï¼Œéœ€è¦æŠŠå®ƒæä¾›ç»™ Observable çš„ subscribe æ–¹æ³•ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">observable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">observer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>è§‚å¯Ÿè€…åªæ˜¯æœ‰ä¸‰ä¸ªå›è°ƒå‡½æ•°çš„å¯¹è±¡ï¼Œæ¯ä¸ªå›è°ƒå‡½æ•°å¯¹åº”ä¸€ç§ Observable å‘é€çš„é€šçŸ¥ç±»å‹ã€‚</strong>
è§‚å¯Ÿè€…ä¹Ÿå¯ä»¥æ˜¯éƒ¨åˆ†çš„</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="subscription">Subscription<a aria-hidden="true" class="hash-link" href="#subscription" title="Direct link to heading">â€‹</a></h2><p>è®¢é˜…</p><p>å½“ä½ è®¢é˜…äº† Observableï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª Subscription ï¼Œ<strong>å®ƒè¡¨ç¤ºè¿›è¡Œä¸­çš„æ‰§è¡Œ</strong>ã€‚åªè¦è°ƒç”¨ unsubscribe() æ–¹æ³•å°±å¯ä»¥å–æ¶ˆæ‰§è¡Œã€‚</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="subject">Subject<a aria-hidden="true" class="hash-link" href="#subject" title="Direct link to heading">â€‹</a></h2><p>ä¸»ä½“ã€‚æ˜¯ä¸€ç§ç‰¹æ®Šçš„ observableï¼ˆHot Observableï¼‰ï¼Œå®ƒå…è®¸å°†å€¼å¤šæ’­ç»™å¤šä¸ªè§‚å¯Ÿè€…ï¼Œæ‰€ä»¥ Subject æ˜¯å¤šæ’­çš„ï¼Œè€Œæ™®é€šçš„ Observables æ˜¯å•æ’­çš„(æ¯ä¸ªå·²è®¢é˜…çš„è§‚å¯Ÿè€…éƒ½æ‹¥æœ‰ Observable çš„ç‹¬ç«‹æ‰§è¡Œ)ã€‚</p><ul><li><strong>æ¯ä¸ª Subject éƒ½æ˜¯ Observableã€‚</strong> -å¯¹äº Subjectï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ªè§‚å¯Ÿè€…å¹¶ä½¿ç”¨ subscribe æ–¹æ³•ï¼Œå°±å¯ä»¥å¼€å§‹æ­£å¸¸æ¥æ”¶å€¼ã€‚ä»è§‚å¯Ÿè€…çš„è§’åº¦è€Œè¨€ï¼Œå®ƒæ— æ³•åˆ¤æ–­ Observable æ‰§è¡Œæ˜¯æ¥è‡ªæ™®é€šçš„ Observable è¿˜æ˜¯ Subject ã€‚</li></ul><p>åœ¨ Subject çš„å†…éƒ¨ï¼Œsubscribe ä¸ä¼šè°ƒç”¨å‘é€å€¼çš„æ–°æ‰§è¡Œã€‚å®ƒåªæ˜¯å°†ç»™å®šçš„è§‚å¯Ÿè€…æ³¨å†Œåˆ°è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ–°çš„è§‚å¯Ÿè€…å¹¶ä¸ä¸€å®šèƒ½æ”¶åˆ° Subject å‘å‡ºçš„æ‰€æœ‰å€¼ï¼Œå®ƒå¯ä»¥æ”¶åˆ°çš„å€¼å–å†³äºå®ƒä½•æ—¶è®¢é˜…ã€‚</p><ul><li><p><strong>æ¯ä¸ª Subject éƒ½æ˜¯è§‚å¯Ÿè€…ã€‚</strong> Subject æ˜¯ä¸€ä¸ªæœ‰å¦‚ä¸‹æ–¹æ³•çš„å¯¹è±¡ï¼š next(v)ã€error(e) å’Œ complete() ã€‚è¦ç»™ Subject æä¾›æ–°å€¼ï¼Œåªè¦è°ƒç”¨ next(theValue)ï¼Œå®ƒä¼šå°†å€¼å¤šæ’­ç»™å·²æ³¨å†Œç›‘å¬è¯¥ Subject çš„è§‚å¯Ÿè€…ä»¬ã€‚</p></li><li><p>Subject ä¸å¯é‡ç”¨ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ª Subject å®Œæˆæˆ–è€…å‡ºé”™æ—¶ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨äº†ã€‚</p></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// The death of a Subject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> subject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">complete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// silently ignored</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Unhandled ObjectUnsubscribedError</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>åœ¨å†…éƒ¨ï¼Œæ¯ä¸ª Subject éƒ½ç»´æŠ¤ç€ä¸€ä¸ªè§‚å¯Ÿè€…æ³¨å†Œè¡¨ï¼ˆä½œä¸ºä¸€ä¸ªæ•°ç»„ï¼‰ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ Subject åœ¨å†…éƒ¨çš„å·¥ä½œæ–¹å¼ï¼š</p><ul><li><p>æ¯æ¬¡æœ‰æ–°çš„è§‚å¯Ÿè€…è®¢é˜…æ—¶ï¼ŒSubject éƒ½ä¼šå°†è§‚å¯Ÿè€…å­˜å‚¨åœ¨è§‚å¯Ÿè€…çš„æ•°ç»„ä¸­</p></li><li><p>å½“å‘å‡ºä¸€ä¸ªæ–°å€¼ï¼ˆå³ next()è°ƒç”¨è¯¥æ–¹æ³•ï¼‰æ—¶ï¼ŒSubject å°†å¾ªç¯éå†è§‚å¯Ÿè€…å¹¶å‘å®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªå‘å‡ºç›¸åŒçš„å€¼ï¼ˆå¤šæ’­ï¼‰ã€‚é”™è¯¯æˆ–å®Œæˆæ—¶ä¹Ÿä¼šå‘ç”ŸåŒæ ·çš„æƒ…å†µ</p></li><li><p>å½“ä¸€ä¸ª Subject å®Œæˆæ—¶ï¼Œæ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½ä¼šè‡ªåŠ¨å–æ¶ˆè®¢é˜…</p></li><li><p>ç›¸åï¼Œå½“ä¸€ä¸ª Subject è¢«å–æ¶ˆè®¢é˜…æ—¶ï¼Œè®¢é˜…å°†ä»ç„¶æœ‰æ•ˆã€‚è§‚å¯Ÿè€…çš„æ•°ç»„è¢«å–æ¶ˆï¼Œä½†ä¸ä¼šå–æ¶ˆè®¢é˜…å®ƒä»¬ã€‚å¦‚æœæ‚¨å°è¯•ä»æœªè®¢é˜…çš„ Subject å‘å‡ºå€¼ï¼Œå®ƒå®é™…ä¸Šä¼šå¼•å‘é”™è¯¯ã€‚æœ€å¥½çš„è¡ŒåŠ¨æ–¹æ¡ˆåº”è¯¥æ˜¯åœ¨æ‚¨éœ€è¦å¤„ç†å®ƒä»¬åŠå…¶è§‚å¯Ÿè€…æ—¶å®Œæˆæ‚¨çš„ Subject ï¼Ÿï¼Ÿï¼ˆæ²¡å¤ªæ‡‚è¿™å¥è¯ï¼‰</p></li><li><p>å½“å…¶ä¸­ä¸€ä¸ªè§‚å¯Ÿè€…å–æ¶ˆè®¢é˜…æ—¶ï¼Œå®ƒå°†ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤</p></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> subject </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// add observer1 to the list of observers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sub1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">observer1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// add observer2 to the list of observers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sub2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">observer2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// notify all observers in the list with &quot;hi there&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subject</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hi there&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// remove observer1 from the list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="behaviorsubject">BehaviorSubject<a aria-hidden="true" class="hash-link" href="#behaviorsubject" title="Direct link to heading">â€‹</a></h3><p>å®ƒæœ‰ä¸€ä¸ªâ€œå½“å‰å€¼â€çš„æ¦‚å¿µã€‚å®ƒä¿å­˜äº†å‘é€ç»™æ¶ˆè´¹è€…çš„æœ€æ–°å€¼ã€‚å¹¶ä¸”å½“æœ‰æ–°çš„è§‚å¯Ÿè€…è®¢é˜…æ—¶ï¼Œä¼šç«‹å³ä» BehaviorSubject é‚£æ¥æ”¶åˆ°â€œå½“å‰å€¼â€ã€‚
BehaviorSubject å¿…é¡»ä¼ å…¥ä¸€ä¸ªåˆå§‹åŒ–çš„å€¼</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="replaysubject">ReplaySubject<a aria-hidden="true" class="hash-link" href="#replaysubject" title="Direct link to heading">â€‹</a></h3><p>ReplaySubject ç±»ä¼¼äº BehaviorSubjectï¼Œå®ƒå¯ä»¥å‘é€æ—§å€¼ç»™æ–°çš„è®¢é˜…è€…ï¼Œä½†å®ƒè¿˜å¯ä»¥è®°å½• Observable æ‰§è¡Œçš„ä¸€éƒ¨åˆ†ã€‚</p><p><strong>ReplaySubject è®°å½• Observable æ‰§è¡Œä¸­çš„å¤šä¸ªå€¼å¹¶å°†å…¶å›æ”¾ç»™æ–°çš„è®¢é˜…è€…ã€‚</strong></p><p>ReplaySubject åœ¨å®ä¾‹åŒ–çš„æ—¶å€™æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºç¼“å†²æ•°é‡ï¼Œç¬¬äºŒä¸ªè¡¨ç¤º window time (ä»¥æ¯«ç§’ä¸ºå•ä½)æ¥ç¡®å®šå¤šä¹…ä¹‹å‰çš„å€¼å¯ä»¥è®°å½•.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="asyncsubject">AsyncSubject<a aria-hidden="true" class="hash-link" href="#asyncsubject" title="Direct link to heading">â€‹</a></h3><p>åªæœ‰å½“ Observable æ‰§è¡Œå®Œæˆæ—¶(æ‰§è¡Œ complete())ï¼Œå®ƒæ‰ä¼šå°†æ‰§è¡Œçš„æœ€åä¸€ä¸ªå€¼å‘é€ç»™è§‚å¯Ÿè€…ã€‚</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="scheduler-è°ƒåº¦å™¨">Scheduler (è°ƒåº¦å™¨)<a aria-hidden="true" class="hash-link" href="#scheduler-è°ƒåº¦å™¨" title="Direct link to heading">â€‹</a></h2><p>è°ƒåº¦å™¨æ§åˆ¶ç€ä½•æ—¶å¯åŠ¨ subscription å’Œä½•æ—¶å‘é€é€šçŸ¥
ç›®å‰è¿˜æ²¡æœ‰ä½¿ç”¨åˆ°è¿‡</p><blockquote><p>è°ƒåº¦å™¨å¯ä»¥è®©ä½ è§„å®š Observable åœ¨ä»€ä¹ˆæ ·çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å‘é€é€šçŸ¥ç»™å®ƒçš„è§‚å¯Ÿè€…ã€‚</p></blockquote><p><a href="https://cn.rx.js.org/manual/overview.html#h17" target="_blank" rel="noopener noreferrer">è°ƒåº¦å™¨ç›¸å…³</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="qa">Q&amp;A<a aria-hidden="true" class="hash-link" href="#qa" title="Direct link to heading">â€‹</a></h2><ol><li>multicast(new Subject()) å’Œ multicast(()=&gt;new Subject())çš„åŒºåˆ«</li></ol><p>å‰è€…å°†ä¸€ä¸ªå†·çš„ observable è½¬åŒ–ä¸ºä¸€ä¸ªçƒ­çš„ observableï¼›åè€…å®é™…ä¸Šæ¯æ¬¡éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ Subjectï¼Œåœ¨æœ‰æ–°çš„è®¢é˜…è€…æ¥ä¸´æ—¶ï¼ˆåœ¨å’Œ refCount é…åˆä½¿ç”¨æ—¶ï¼Œå› ä¸º refCount ä¼šåœ¨æœ‰æ–°çš„è®¢é˜…è€…å‡ºç°æ—¶ä½¿ç”¨ connect å¼€å§‹å…±äº«çš„æ‰§è¡Œï¼‰ï¼Œå¦‚æœå‰ä¸€ä¸ª subject å·²ç» complete çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ª Subjectï¼Œæ‰€ä»¥åè€…è¿˜æ˜¯ä¼šæ¥æ”¶åˆ°å€¼ã€‚å› æ­¤åè€…è¿˜æ˜¯ä¸€ä¸ªå†·çš„ observableï¼Œå¤šæ’­ä¸€èˆ¬ä½¿ç”¨å‰è€…ã€‚</p><p>å£è¯´æ— å‡­ï¼Œçœ‹ä¾‹å­</p><ul><li>multicast(new Subject())</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> multicasted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">multicast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">refCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨åº•å±‚ä½¿ç”¨äº† `subject.subscribe({...})`:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">v</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;observerA: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">v</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;observerB: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// multicasted.connect()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¸Šé¢è¿™ç§å†™æ³•ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ refCount è¿˜æ˜¯æ‰‹åŠ¨ connect ç»“æœéƒ½ä¸€æ ·</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>multicast(()=&gt;new Subject()) + refCount() === share()</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> multicasted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">multicast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">refCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨åº•å±‚ä½¿ç”¨äº† `subject.subscribe({...})`:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">v</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;observerA: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">v</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;observerB: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç»“æœ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerB: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerB: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerB: 3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>multicast(()=&gt;new Subject()) + æ‰‹åŠ¨ connect</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> multicasted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">multicast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Subject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åœ¨åº•å±‚ä½¿ç”¨äº† `subject.subscribe({...})`:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">v</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;observerA: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token parameter">v</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;observerB: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multicasted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ç»“æœ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observerA: 3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="2"><li>publish().refCount() æˆ– share()çš„æ•ˆæœ</li></ol><p>åŒæ—¶æ¥é€šçš„å¤šä¸ªè®¢é˜…è€…ä¸ä¼šé‡å¤è§¦å‘ä¸Šæ¸¸çš„é€»è¾‘ï¼›ä½†å…¨éƒ¨å–æ¶ˆè®¢é˜…ä¹‹åå†æ¥é€šï¼Œå°±ä¼šå†èµ°ä¸€éä¸Šæ¸¸ (é‡è®¢é˜…)ï¼› å› æ­¤å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„â€œç¼“å­˜â€</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ¨èé˜…è¯»">æ¨èé˜…è¯»<a aria-hidden="true" class="hash-link" href="#æ¨èé˜…è¯»" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://blog.bitsrc.io/rxjs-subjects-in-depth-56dcfc1dc858" target="_blank" rel="noopener noreferrer">rxjs-subjects-in-depth</a></li><li><a href="https://www.digitalocean.com/community/tutorials/rxjs-subjects" target="_blank" rel="noopener noreferrer">how to use Subjects</a></li><li><a href="https://benlesh.medium.com/on-the-subject-of-subjects-in-rxjs-2b08b7198b93" target="_blank" rel="noopener noreferrer">å…³äº RxJS Subject ä¸€äº›è¯¯ç”¨åœºæ™¯çš„ä»‹ç»</a></li><li><a href="https://zhuanlan.zhihu.com/p/33621290" target="_blank" rel="noopener noreferrer">å¦‚ä½•ä½¿ç”¨ refCount</a></li><li><a href="https://zhuanlan.zhihu.com/p/33225623" target="_blank" rel="noopener noreferrer">publish å’Œ share</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/Blog/docs/tags/rxjs">Rxjs</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Blog/docs/æ¡†æ¶&amp;å¸¸ç”¨åº“/Rxjs/rxjs-operators"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->rxjs æ“ä½œç¬¦</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Blog/docs/ç½‘ç»œ/dns"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DNSä½•æ—¶ä½¿ç”¨TCPåè®®ï¼Œä½•æ—¶ä½¿ç”¨UDPåè®®ï¼Ÿ<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rxjs-æ˜¯ä»€ä¹ˆ" class="table-of-contents__link toc-highlight">Rxjs æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href="#ç‰¹ç‚¹" class="table-of-contents__link toc-highlight">ç‰¹ç‚¹</a></li><li><a href="#rxjs-observables-vs-promise" class="table-of-contents__link toc-highlight">Rxjs Observables vs Promise</a><ul><li><a href="#å¤šå€¼-vs-å•å€¼" class="table-of-contents__link toc-highlight">å¤šå€¼ vs å•å€¼</a></li><li><a href="#ä»£ç æ‰§è¡Œ" class="table-of-contents__link toc-highlight">ä»£ç æ‰§è¡Œ</a></li><li><a href="#-èƒ½å–æ¶ˆ-vs-ä¸èƒ½å–æ¶ˆ" class="table-of-contents__link toc-highlight"> èƒ½å–æ¶ˆ vs ä¸èƒ½å–æ¶ˆ</a></li><li><a href="#å¤šä¸ªè®¢é˜…-vs-å•ä¸ªè®¢é˜…" class="table-of-contents__link toc-highlight">å¤šä¸ªè®¢é˜… vs å•ä¸ªè®¢é˜…</a></li><li><a href="#å¯èƒ½æ˜¯å¼‚æ­¥-vs-ä¸€ç›´æ˜¯å¼‚æ­¥" class="table-of-contents__link toc-highlight">å¯èƒ½æ˜¯å¼‚æ­¥ vs ä¸€ç›´æ˜¯å¼‚æ­¥</a></li></ul></li><li><a href="#observable" class="table-of-contents__link toc-highlight">Observable</a><ul><li><a href="#cold-observable" class="table-of-contents__link toc-highlight">Cold Observable</a></li><li><a href="#hot-observable" class="table-of-contents__link toc-highlight">Hot Observable</a></li></ul></li><li><a href="#observer" class="table-of-contents__link toc-highlight">Observer</a><ul><li><a href="#ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…" class="table-of-contents__link toc-highlight">ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…ï¼Ÿ</a></li></ul></li><li><a href="#subscription" class="table-of-contents__link toc-highlight">Subscription</a></li><li><a href="#subject" class="table-of-contents__link toc-highlight">Subject</a><ul><li><a href="#behaviorsubject" class="table-of-contents__link toc-highlight">BehaviorSubject</a></li><li><a href="#replaysubject" class="table-of-contents__link toc-highlight">ReplaySubject</a></li><li><a href="#asyncsubject" class="table-of-contents__link toc-highlight">AsyncSubject</a></li></ul></li><li><a href="#scheduler-è°ƒåº¦å™¨" class="table-of-contents__link toc-highlight">Scheduler (è°ƒåº¦å™¨)</a></li><li><a href="#qa" class="table-of-contents__link toc-highlight">Q&amp;A</a></li><li><a href="#æ¨èé˜…è¯»" class="table-of-contents__link toc-highlight">æ¨èé˜…è¯»</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/Blog/assets/js/runtime~main.fa86c0dc.js"></script>
<script src="/Blog/assets/js/main.f4361df4.js"></script>
</body>
</html>